<!DOCTYPE html>
<!-- saved from url=(0049)https://www.cnblogs.com/kevingrace/p/5919021.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="origin">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园</title>
    <meta property="og:description" content="在日常运维工作中，对于系统和业务日志的处理尤为重要。今天，在这里分享一下自己部署的ELK（+Redis）-开源实时日志分析平台的记录过程（仅依据本人的实际操作为例说明，如有误述，敬请指出）~ 概念介绍">
    <link type="text/css" rel="stylesheet" href="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/bundle-coffee.css">
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/bundle-coffee-mobile.css">
    <link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/kevingrace/rss">
    <link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/kevingrace/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/kevingrace/wlwmanifest.xml">
    <script src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/amp4ads-host-v0.js.下载"></script><script src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/pubads_impl_rendering_2019072601.js.下载"></script><script async="" src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/analytics.js.下载"></script><script src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/jquery-2.2.0.min.js.下载"></script>
    <script>var currentBlogId=271300;var currentBlogApp='kevingrace',cb_enable_mathjax=false;var isLogined=false;</script>
    <script src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/blog-common.js.下载" type="text/javascript"></script>
<link rel="preload" href="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/f.txt" as="script"><script type="text/javascript" src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/f.txt"></script><script src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/pubads_impl_2019072601.js.下载" async=""></script><link rel="prefetch" href="https://tpc.googlesyndication.com/safeframe/1-0-35/html/container.html"></head>
<body>
<a name="top"></a>


<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="https://www.cnblogs.com/kevingrace/"><img id="blogLogo" src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/logo.gif" alt="返回主页"></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="https://www.cnblogs.com/kevingrace/">散尽浮华</a></h1>
<h2>安寻安放，不卑不亢；重剑无锋，大巧不工！</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="navigator">
			
<ul id="navList">
	<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">博客园</a></li>
	<li><a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/kevingrace/">首页</a></li>
	<li><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
	<li><a id="blog_nav_contact" accesskey="9" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/%E6%95%A3%E5%B0%BD%E6%B5%AE%E5%8D%8E">联系</a></li>
	<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
	<li><a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/kevingrace/rss">订阅</a>
	<a id="blog_nav_rss_image" class="aHeaderXML" href="https://www.cnblogs.com/kevingrace/rss"><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/xml.gif" alt="订阅"></a></li>
</ul>


			<div class="blogStats">
				
				<div id="blog_stats">
<!--done-->
随笔- 544&nbsp;
文章- 34&nbsp;
评论- 661&nbsp;
</div>
				
			</div><!--end: blogStats -->
		</div><!--end: navigator 博客导航栏 -->
		
        <div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/kevingrace/p/5919021.html">ELK实时日志分析平台环境部署--完整记录</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><p>&nbsp;</p>
<p>在日常运维工作中，对于系统和业务日志的处理尤为重要。今天，在这里分享一下自己部署的ELK（+Redis）-开源实时日志分析平台的记录过程<span style="background-color: #ccffcc;">（仅依据本人的实际操作为例说明，如有误述，敬请指出）</span>~</p>
<p><strong><span style="font-size: 18px; background-color: #ffff00;">================概念介绍================</span></strong><br>日志主要包括系统日志、应用程序日志和安全日志。系统运维和开发人员可以通过日志了解服务器软硬件信息、检查配置过程中的错误及错误发生的原因。经常分析日志可以了解服务器的负荷，性能安全性，从而及时采取措施纠正错误。<br>   <br>通常，日志被分散在储存不同的设备上。如果你管理数十上百台服务器，你还在使用依次登录每台机器的传统方法查阅日志。这样是不是感觉很繁琐和效率低下。当务之急我们使用集中化的日志管理，例如：开源的syslog，将所有服务器上的日志收集汇总。</p>
<p>集中化管理日志后，日志的统计和检索又成为一件比较麻烦的事情，一般我们使用grep、awk和wc等Linux命令能实现检索和统计，但是对于要求更高的查询、排序和统计等要求和庞大的机器数量依然使用这样的方法难免有点力不从心。</p>
<p>通过我们需要对日志进行集中化管理，将所有机器上的日志信息收集、汇总到一起。<strong><span style="background-color: #ffffff; color: #ff6600;">完整的日志数据具有非常重要的作用：</span></strong><br><span style="background-color: #ffffff; color: #ff6600;">1）信息查找</span>。通过检索日志信息，定位相应的bug，找出解决方案。<br><span style="color: #ff6600;">2）服务诊断</span>。通过对日志信息进行统计、分析，了解服务器的负荷和服务运行状态，找出耗时请求进行优化等等。<br><span style="color: #ff6600;">3）数据分析</span>。如果是格式化的log，可以做进一步的数据分析，统计、聚合出有意义的信息，比如根据请求中的商品id，找出TOP10用户感兴趣商品。</p>
<p>开源实时日志分析ELK平台能够完美的解决我们上述的问题，<span style="background-color: #ff99cc;">ELK由ElasticSearch、Logstash和Kiabana三个开源工具</span>组成：<br><span style="background-color: #99ccff;">1）ElasticSearch</span>是一个基于Lucene的开源分布式搜索服务器。它的特点有：分布式，零配置，自动发现，索引自动分片，索引副本机制，restful风格接口，多数据源，自动搜索负载等。它提供了一个分布式多用户能力的全文搜索引擎，基于RESTful web接口。Elasticsearch是用Java开发的，并作为Apache许可条款下的开放源码发布，是第二流行的企业搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。 <br>在elasticsearch中，所有节点的数据是均等的。<br><span style="background-color: #99ccff;">2）Logstash</span>是一个完全开源的工具，它可以对你的日志进行收集、过滤、分析，支持大量的数据获取方法，并将其存储供以后使用（如搜索）。说到搜索，logstash带有一个web界面，搜索和展示所有日志。一般工作方式为c/s架构，client端安装在需要收集日志的主机上，server端负责将收到的各节点日志进行过滤、修改等操作在一并发往elasticsearch上去。<br><span style="background-color: #99ccff;">3）Kibana</span> 是一个基于浏览器页面的Elasticsearch前端展示工具，也是一个开源和免费的工具，Kibana可以为 Logstash 和 ElasticSearch 提供的日志分析友好的 Web 界面，可以帮助您汇总、分析和搜索重要数据日志。</p>
<p><span style="font-size: 16px;"><strong><span style="color: #ff0000;">为什么要用到ELK？</span></strong></span><br>一般我们需要进行日志分析场景是：直接在日志文件中 grep、awk 就可以获得自己想要的信息。但在规模较大的场景中，此方法效率低下，面临问题包括日志量太大如何归档、文本搜索太慢怎么办、如何多维度查询。需要集中化的日志管理，所有服务器上的日志收集汇总。常见解决思路是建立集中式日志收集系统，将所有节点上的日志统一收集，管理，访问。<br>一般大型系统是一个分布式部署的架构，不同的服务模块部署在不同的服务器上，问题出现时，大部分情况需要根据问题暴露的关键信息，定位到具体的服务器和服务模块，构建一套集中式日志系统，可以提高定位问题的效率。</p>
<p>一般大型系统是一个分布式部署的架构，不同的服务模块部署在不同的服务器上，问题出现时，大部分情况需要根据问题暴露的关键信息，定位到具体的服务器和服务模块，构建一套集中式日志系统，可以提高定位问题的效率。<br><span style="color: #ff0000; font-size: 16px;"><strong>一个完整的集中式日志系统，需要包含以下几个主要特点：</strong></span><br>1）收集－能够采集多种来源的日志数据<br>2）传输－能够稳定的把日志数据传输到中央系统<br>3）存储－如何存储日志数据<br>4）分析－可以支持 UI 分析<br>5）警告－能够提供错误报告，监控机制</p>
<p>ELK提供了一整套解决方案，并且都是开源软件，之间互相配合使用，完美衔接，高效的满足了很多场合的应用。目前主流的一种日志系统。</p>
<p><span style="font-size: 16px;"><strong><span style="color: #ff0000;">ELK工作原理展示图：</span></strong></span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20160929103612391-738607927.png" alt=""></p>
<p>如上图：Logstash收集AppServer产生的Log，并存放到ElasticSearch集群中，而Kibana则从ES集群中查询数据生成图表，再返回给Browser。</p>
<p><span style="font-size: 16px;"><strong><span style="color: #ff0000;">Logstash工作原理：</span></strong></span><br>Logstash事件处理有三个阶段：inputs → filters → outputs。是一个接收，处理，转发日志的工具。支持系统日志，webserver日志，错误日志，应用日志，总之包括所有可以抛出来的日志类型。</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20180425171745495-2019221212.png" alt=""></p>
<p><span style="color: #ff6600;"><strong>Input：输入数据到logstash。</strong></span></p>
<p><strong><span style="color: #0000ff;">一些常用的输入为：</span></strong><br>file：从文件系统的文件中读取，类似于tial -f命令<br>syslog：在514端口上监听系统日志消息，并根据RFC3164标准进行解析<br>redis：从redis service中读取<br>beats：从filebeat中读取<br>Filters：数据中间处理，对数据进行操作。</p>
<p><strong><span style="color: #0000ff;">一些常用的过滤器为：</span></strong><br>grok：解析任意文本数据，Grok 是 Logstash 最重要的插件。它的主要作用就是将文本格式的字符串，转换成为具体的结构化的数据，配合正则表达式使用。内置120多个解析语法。<br>mutate：对字段进行转换。例如对字段进行删除、替换、修改、重命名等。<br>drop：丢弃一部分events不进行处理。<br>clone：拷贝 event，这个过程中也可以添加或移除字段。<br>geoip：添加地理信息(为前台kibana图形化展示使用)<br>Outputs：outputs是logstash处理管道的最末端组件。一个event可以在处理过程中经过多重输出，但是一旦所有的outputs都执行结束，这个event也就完成生命周期。</p>
<p><strong><span style="color: #0000ff;">一些常见的outputs为：</span></strong><br>elasticsearch：可以高效的保存数据，并且能够方便和简单的进行查询。<br>file：将event数据保存到文件中。<br>graphite：将event数据发送到图形化组件中，一个很流行的开源存储图形化展示的组件。<br>Codecs：codecs 是基于数据流的过滤器，它可以作为input，output的一部分配置。Codecs可以帮助你轻松的分割发送过来已经被序列化的数据。</p>
<p><span style="color: #0000ff;"><strong>一些常见的codecs：</strong></span><br>json：使用json格式对数据进行编码/解码。<br>multiline：将汇多个事件中数据汇总为一个单一的行。比如：java异常信息和堆栈信息。</p>
<p><span style="background-color: #ffff00;"><strong>======================<span style="font-size: 18px;">ELK整体方案</span>=======================</strong></span><br>ELK中的三个系统分别扮演不同的角色，组成了一个整体的解决方案。Logstash是一个ETL工具，负责从每台机器抓取日志数据，对数据进行格式转换和处理后，输出到Elasticsearch中存储。Elasticsearch是一个分布式搜索引擎和分析引擎，用于数据存储，可提供实时的数据查询。Kibana是一个数据可视化服务，根据用户的操作从Elasticsearch中查询数据，形成相应的分析结果，以图表的形式展现给用户。 <br>ELK的安装很简单，可以按照"下载-&gt;修改配置文件-&gt;启动"方法分别部署三个系统，也可以使用docker来快速部署。具体的安装方法这里不详细介绍，下面来看一个常见的部署方案，如下图所示，部署思路是：<br>1）在每台生成日志文件的机器上，部署Logstash，作为Shipper的角色，负责从日志文件中提取数据，但是不做任何处理，直接将数据输出到Redis队列(list)中；<br>2）需要一台机器部署Logstash，作为Indexer的角色，负责从Redis中取出数据，对数据进行格式化和相关处理后，输出到Elasticsearch中存储；<br>3）部署Elasticsearch集群，当然取决于你的数据量了，数据量小的话可以使用单台服务，如果做集群的话，最好是有3个以上节点，同时还需要部署相关的监控插件；<br>4）部署Kibana服务，提供Web服务。</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20180425172936102-2010066031.png" alt=""></p>
<p>在前期部署阶段，主要工作是Logstash节点和Elasticsearch集群的部署，而在后期使用阶段，主要工作就是Elasticsearch集群的监控和使用Kibana来检索、分析日志数据了，当然也可以直接编写程序来消费Elasticsearch中的数据。</p>
<p>在上面的部署方案中，我们将Logstash分为Shipper和Indexer两种角色来完成不同的工作，中间通过Redis做数据管道，为什么要这样做？为什么不是直接在每台机器上使用Logstash提取数据、处理、存入Elasticsearch？</p>
<p>首先，采用这样的架构部署，有三点优势：<strong><span style="color: #ff0000;">第一</span></strong>，降低对日志所在机器的影响，这些机器上一般都部署着反向代理或应用服务，本身负载就很重了，所以尽可能的在这些机器上少做事；<span style="color: #ff0000;"><strong>第二</strong></span>，如果有很多台机器需要做日志收集，那么让每台机器都向Elasticsearch持续写入数据，必然会对Elasticsearch造成压力，因此需要对数据进行缓冲，同时，这样的缓冲也可以一定程度的保护数据不丢失；<strong><span style="color: #ff0000;">第三</span></strong>，将日志数据的格式化与处理放到Indexer中统一做，可以在一处修改代码、部署，避免需要到多台机器上去修改配置。&nbsp;</p>
<p>其次，我们需要做的是将数据放入一个消息队列中进行缓冲，所以Redis只是其中一个选择，也可以是RabbitMQ、Kafka等等，在实际生产中，Redis与Kafka用的比较多。由于Redis集群一般都是通过key来做分片，无法对list类型做集群，在数据量大的时候必然不合适了，而Kafka天生就是分布式的消息队列系统。</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20180425173152360-1768691984.png" alt=""></p>
<p><strong><span style="color: #993366;">1）配置nginx日志格式</span> </strong><br>首先需要将nginx日志格式规范化，便于做解析处理。在nginx.conf文件中设置：</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_699778" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">log_format main </code><code class="bash string">'$remote_addr "$time_iso8601" "$request" $status $body_bytes_sent "$http_user_agent" "$http_referer" "$http_x_forwarded_for" "$request_time" "$upstream_response_time" "$http_cookie" "$http_Authorization" "$http_token"'</code><code class="bash plain">;</code></div><div class="line number2 index1 alt1"><code class="bash plain">access_log&nbsp; </code><code class="bash plain">/var/log/nginx/example</code><code class="bash plain">.access.log&nbsp; main;</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong><span style="color: #993366;">2）nginx日志–&gt;&gt;Logstash–&gt;&gt;消息队列</span> </strong><br>这部分是Logstash Shipper的工作，涉及input和output两种插件。input部分，由于需要提取的是日志文件，一般使用file插件，该插件常用的几个参数是：<br>path：指定日志文件路径。<br>type：指定一个名称，设置type后，可以在后面的filter和output中对不同的type做不同的处理，适用于需要消费多个日志文件的场景。<br>start_position：指定起始读取位置，“beginning”表示从文件头开始，“end”表示从文件尾开始（类似tail -f）。<br>sincedb_path：与Logstash的一个坑有关。通常Logstash会记录每个文件已经被读取到的位置，保存在sincedb中，如果Logstash重启，那么对于同一个文件，会继续从上次记录的位置开始读取。如果想重新从头读取文件，需要删除sincedb文件，sincedb_path则是指定了该文件的路径。为了方便，我们可以根据需要将其设置为“/dev/null”，即不保存位置信息。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_852086" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">input {</code></div><div class="line number2 index1 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">file</code> <code class="bash plain">{</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">type</code> <code class="bash plain">=&gt; </code><code class="bash string">"example_nginx_access"</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">path =&gt; [</code><code class="bash string">"/var/log/nginx/example.access.log"</code><code class="bash plain">]</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">start_position =&gt; </code><code class="bash string">"beginning"</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">sincedb_path =&gt; </code><code class="bash string">"/dev/null"</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number9 index8 alt2"><code class="bash plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>output部分，将数据输出到消息队列，以redis为例，需要指定redis server和list key名称。另外，在测试阶段，可以使用stdout来查看输出信息。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_610489" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 输出到redis</code></div><div class="line number2 index1 alt1"><code class="bash plain">output {</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">[</code><code class="bash functions">type</code><code class="bash plain">] == </code><code class="bash string">"example_nginx_access"</code> <code class="bash plain">{</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">redis {</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">host =&gt; </code><code class="bash string">"127.0.0.1"</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">port =&gt; </code><code class="bash string">"6379"</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">data_type =&gt; </code><code class="bash string">"list"</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">key =&gt; </code><code class="bash string">"logstash:example_nginx_access"</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash comments">#&nbsp; stdout {codec =&gt; rubydebug}</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number12 index11 alt1"><code class="bash plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong><span style="color: #993366;">3）消息队列–&gt;&gt;Logstash–&gt;&gt;Elasticsearch</span> </strong><br>这部分是Logstash Indexer的工作，涉及input、filter和output三种插件。在input部分，我们通过redis插件将数据从消息队列中取出来。在output部分，我们通过elasticsearch插件将数据写入Elasticsearch。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_315741" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash comments"># 从redis输入数据</code></div><div class="line number2 index1 alt1"><code class="bash plain">input {</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">redis {</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">host =&gt; </code><code class="bash string">"127.0.0.1"</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">port =&gt; </code><code class="bash string">"6379"</code></div><div class="line number6 index5 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">data_type =&gt; </code><code class="bash string">"list"</code></div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">key =&gt; </code><code class="bash string">"logstash:example_nginx_access"</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number9 index8 alt2"><code class="bash plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="bash plain">output {</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">elasticsearch {</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">index =&gt; </code><code class="bash string">"logstash-example-nginx-%{+YYYY.MM}"</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">hosts =&gt; [</code><code class="bash string">"127.0.0.1:9200"</code><code class="bash plain">]</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number16 index15 alt1"><code class="bash plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>这里，需要重点关注filter部分，下面列举几个常用的插件，实际使用中根据自身需求从官方文档中查找适合自己业务的插件并使用即可，当然也可以编写自己的插件。<br><strong><span style="color: #ff00ff;">grok：</span></strong>是Logstash最重要的一个插件，用于将非结构化的文本数据转化为结构化的数据。grok内部使用正则语法对文本数据进行匹配，为了降低使用复杂度，其提供了一组pattern，我们可以直接调用pattern而不需要自己写正则表达式，参考源码grok-patterns。grok解析文本的语法格式是%{SYNTAX:SEMANTIC}，SYNTAX是pattern名称，SEMANTIC是需要生成的字段名称，使用工具Grok Debugger可以对解析语法进行调试。例如，在下面的配置中，我们先使用grok对输入的原始nginx日志信息（默认以message作为字段名）进行解析，并添加新的字段request_path_with_verb（该字段的值是verb和request_path的组合），然后对request_path字段做进一步解析。<br><strong><span style="color: #ff00ff;">kv：</span></strong>用于将某个字段的值进行分解，类似于编程语言中的字符串Split。在下面的配置中，我们将request_args字段值按照“&amp;”进行分解，分解后的字段名称以“request_args_”作为前缀，并且丢弃重复的字段。<br><strong><span style="color: #ff00ff;">geoip：</span></strong>用于根据IP信息生成地理位置信息，默认使用自带的一份GeoLiteCity database，也可以自己更换为最新的数据库，但是需要数据格式需要遵循Maxmind的格式（参考GeoLite），似乎目前只能支持legacy database，数据类型必须是.dat。下载GeoLiteCity.dat.gz后解压， 并将文件路径配置到source中即可。<br><strong><span style="color: #ff00ff;">translate：</span></strong>用于检测某字段的值是否符合条件，如果符合条件则将其翻译成新的值，写入一个新的字段，匹配pattern可以通过YAML文件来配置。例如，在下面的配置中，我们对request_api字段翻译成更加易懂的文字描述。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_67212" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">filter {</code></div><div class="line number2 index1 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">grok {</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">match =&gt; {</code><code class="bash string">"message"</code> <code class="bash plain">=&gt; </code><code class="bash string">"%{IPORHOST:client_ip} \"%{TIMESTAMP_ISO8601:timestamp}\" \"%{WORD:verb} %{NOTSPACE:request_path} HTTP/%{NUMBER:httpversion}\" %{NUMBER:response_status:int} %{NUMBER:response_body_bytes:int} \"%{DATA:user_agent}\" \"%{DATA:http_referer}\" \"%{NOTSPACE:http_x_forwarder_for}\" \"%{NUMBER:request_time:float}\" \"%{DATA:upstream_resopnse_time}\" \"%{DATA:http_cookie}\" \"%{DATA:http_authorization}\" \"%{DATA:http_token}\""</code><code class="bash plain">}</code></div><div class="line number4 index3 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">add_field =&gt; {</code><code class="bash string">"request_path_with_verb"</code> <code class="bash plain">=&gt; </code><code class="bash string">"%{verb} %{request_path}"</code><code class="bash plain">}</code></div><div class="line number5 index4 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">grok {</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">match =&gt; {</code><code class="bash string">"request_path"</code> <code class="bash plain">=&gt; </code><code class="bash string">"%{URIPATH:request_api}(?:\?%{NOTSPACE:request_args}|)"</code><code class="bash plain">}</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">add_field =&gt; {</code><code class="bash string">"request_annotation"</code> <code class="bash plain">=&gt; </code><code class="bash string">"%{request_api}"</code><code class="bash plain">}</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">kv {</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">prefix =&gt; </code><code class="bash string">"request_args_"</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">field_split =&gt; </code><code class="bash string">"&amp;"</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">source</code> <code class="bash plain">=&gt; </code><code class="bash string">"request_args"</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">allow_duplicate_values =&gt; </code><code class="bash functions">false</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">geoip {</code></div><div class="line number20 index19 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">source</code> <code class="bash plain">=&gt; </code><code class="bash string">"client_ip"</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">database =&gt; </code><code class="bash string">"/home/elktest/geoip_data/GeoLiteCity.dat"</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;</code><code class="bash plain">translate {</code></div><div class="line number25 index24 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">field =&gt; request_path</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">destination =&gt; request_annotation</code></div><div class="line number27 index26 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">regex =&gt; </code><code class="bash functions">true</code></div><div class="line number28 index27 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">exact =&gt; </code><code class="bash functions">true</code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">dictionary_path =&gt; </code><code class="bash string">"/home/elktest/api_annotation.yaml"</code></div><div class="line number30 index29 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">override =&gt; </code><code class="bash functions">true</code></div><div class="line number31 index30 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number32 index31 alt1"><code class="bash plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="font-size: 16px;"><strong><span style="color: #ff0000;">Elasticsearch</span></strong></span><br>Elasticsearch承载了数据存储和查询的功能，其基础概念和使用方法可以参考另一篇博文Elasticsearch使用总结，这里主要介绍些实际生产中的问题和方法：<br><strong><span style="color: #339966;">1）关于集群配置</span></strong><span style="color: #000000;">，重点关注三个参数</span>：第一，discovery.zen.ping.unicast.hosts，Elasticsearch默认使用Zen Discovery来做节点发现机制，推荐使用unicast来做通信方式，在该配置项中列举出Master节点。第二，discovery.zen.minimum_master_nodes，该参数表示集群中可工作的具有Master节点资格的最小数量，默认值是1。为了提高集群的可用性，避免脑裂现象（所谓脑裂，就是同一个集群中的不同节点，对集群的状态有不一致的理解。），官方推荐设置为(N/2)+1，其中N是具有Master资格的节点的数量。第三，discovery.zen.ping_timeout，表示节点在发现过程中的等待时间，默认值是3秒，可以根据自身网络环境进行调整，一定程度上提供可用性。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_634930" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">discovery.zen.</code><code class="bash functions">ping</code><code class="bash plain">.unicast.hosts: [</code><code class="bash string">"master1"</code><code class="bash plain">, </code><code class="bash string">"master2"</code><code class="bash plain">, </code><code class="bash string">"master3"</code><code class="bash plain">] </code></div><div class="line number2 index1 alt1"><code class="bash plain">discovery.zen.minimum_master_nodes: 2</code></div><div class="line number3 index2 alt2"><code class="bash plain">discovery.zen.ping_timeout: 10</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong><span style="color: #339966;">2）关于集群节点</span></strong>，第一，节点类型包括：候选Master节点、数据节点和Client节点。通过设置两个配置项node.master和node.data为true或false，来决定将一个节点分配为什么类型的节点。第二，尽量将候选Master节点和Data节点分离开，通常Data节点负载较重，需要考虑单独部署。<br><strong><span style="color: #339966;">3）关于内存</span></strong>，Elasticsearch默认设置的内存是1GB，对于任何一个业务部署来说，这个都太小了。通过指定ES_HEAP_SIZE环境变量，可以修改其堆内存大小，服务进程在启动时候会读取这个变量，并相应的设置堆的大小。建议设置系统内存的一半给Elasticsearch，但是不要超过32GB。参考官方文档。<br><strong><span style="color: #339966;">4）关于硬盘空间</span></strong>，Elasticsearch默认将数据存储在/var/lib/elasticsearch路径下，随着数据的增长，一定会出现硬盘空间不够用的情形，此时就需要给机器挂载新的硬盘，并将Elasticsearch的路径配置到新硬盘的路径下。通过“path.data”配置项来进行设置，比如“path.data: /data1,/var/lib/elasticsearch,/data”。需要注意的是，同一分片下的数据只能写入到一个路径下，因此还是需要合理的规划和监控硬盘的使用。<br><strong><span style="color: #339966;">5）关于Index的划分和分片的个数</span></strong>，这个需要根据数据量来做权衡了，Index可以按时间划分，比如每月一个或者每天一个，在Logstash输出时进行配置，shard的数量也需要做好控制。<br><strong><span style="color: #339966;">6）关于监控</span></strong>，笔者使用过head和marvel两个监控插件，head免费，功能相对有限，marvel现在需要收费了。另外，不要在数据节点开启监控插件。 </p>
<p>Kibana<br>Kibana提供的是数据查询和显示的Web服务，有丰富的图表样板，能满足大部分的数据可视化需求，这也是很多人选择ELK的主要原因之一。UI的操作没有什么特别需要介绍的，经常使用就会熟练，这里主要介绍经常遇到的三个问题。 <br><span style="color: #993366;">a）查询语法</span> <br>在Kibana的Discover页面中，可以输入一个查询条件来查询所需的数据。查询条件的写法使用的是Elasticsearch的Query String语法，而不是Query DSL，参考官方文档query-string-syntax，这里列举其中部分常用的：<br><span style="color: #ff00ff;">.单字段的全文检索</span>，比如搜索args字段中包含first的文档，写作 args:first；<br><span style="color: #ff00ff;">.单字段的精确检索</span>，比如搜索args字段值为first的文档，写作 args: “first”；<br><span style="color: #ff00ff;">.多个检索条件的组合</span>，使用 NOT, AND 和 OR 来组合，注意必须是大写，比如 args:(“first” OR “second”) AND NOT agent: “third”；<br><span style="color: #ff00ff;">.字段是否存在</span>，_exists_:agent表示要求agent字段存在，_missing_:agent表示要求agent字段不存在；<br><span style="color: #ff00ff;">.通配符</span>：用 ? 表示单字母，* 表示任意个字母。<br><span style="color: #993366;">b）错误“Discover: Request Timeout after 30000ms”</span> <br>这个错误经常发生在要查询的数据量比较大的情况下，此时Elasticsearch需要较长时间才能返回，导致Kibana发生Timeout报错。解决这个问题的方法，就是在Kibana的配置文件中修改elasticsearch.requestTimeout一项的值，然后重启Kibana服务即可，注意单位是ms。<br><span style="color: #993366;">c）疑惑“字符串被分解了</span>” <br>经常碰到这样一个问题：<span style="color: #ff6600;">为什么查询结果的字段值是正确的，可是做图表时却发现字段值被分解了，不是想要的结果？如下图所示的client_agent_info字段。</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20180425174105813-1131749492.png" alt=""></p>
<p>得到这样一个不正确结果的原因是使用了Analyzed字段来做图表分析，默认情况下Elasticsearch会对字符串数据进行分析，建立倒排索引，所以如果对这么一个字段进行terms聚合，必然会得到上面所示的错误结果了。那么应该怎么做才对？默认情况下，Elasticsearch还会创建一个相对应的没有被Analyzed的字段，即带“.raw”后缀的字段，在这样的字段上做聚合分析即可。 <br>又会有很多人问这样的问题：为什么我的Elasticsearch没有自动创建带“.raw”后缀的字段？然而在Logstash中输出数据时，设置index名称前缀为“logstash-”就有了这个字段。这个问题的根源是Elasticsearch的dynamic template在捣鬼，dynamic temlate用于指导Elasticsearch如何为插入的数据自动建立Schema映射关系，默认情况下，Logstash会在Elasticsearch中建立一个名为“logstash”的模板，所有前缀为“logstash-”的index都会参照这个模板来建立映射关系，在该模板中申明了要为每个字符串数据建立一个额外的带“.raw”后缀的字段。可以向Elasticsearch来查询你的模板，使用API：GET http://localhost:9200/_template。 </p>
<p>以上便是对ELK日志系统的总结介绍，还有一个重要的功能没有提到，就是如何将日志数据与自身产品业务的数据融合起来。举个例子，在nginx日志中，通常会包含API请求访问时携带的用户Token信息，由于Token是有时效性的，我们需要及时将这些Token转换成真实的用户信息存储下来。这样的需求通常有两种实现方式，一种是自己写一个Logstash filter，然后在Logstash处理数据时调用；另一种是将Logstash Indexer产生的数据再次输出到消息队列中，由我们自己的脚本程序从消息队列中取出数据，做相应的业务处理后，输出到Elasticsearch中。</p>
<p><span style="font-size: 18px; background-color: #ffff00;">==================<strong>ELK环境部署</strong>==================</span></p>
<p><span style="background-color: #ffcc99;">（0）基础环境介绍</span></p>
<p>系统： Centos7.1<br>防火墙： 关闭<br>Sellinux: 关闭</p>
<p>机器环境： 两台<br>elk-node1: 192.168.1.160 &nbsp; &nbsp; &nbsp; <strong><span style="color: #008000;">#master机器</span></strong><br>elk-node2：192.168.1.161 &nbsp; &nbsp; &nbsp;<span style="color: #008000;"><strong>#slave机器</strong></span></p>
<p><span style="color: #0000ff;">注明： </span><br><span style="color: #0000ff;">master-slave模式：</span><br><span style="color: #0000ff;">master收集到日志后，会把一部分数据碎片到salve上（随机的一部分数据）；同时，master和slave又都会各自做副本，并把副本放到对方机器上，这样就保证了数据不会丢失。</span><br><span style="color: #0000ff;">如果master宕机了，那么客户端在日志采集配置中将elasticsearch主机指向改为slave，就可以保证ELK日志的正常采集和web展示。</span></p>
<p><span style="color: #ff00ff; background-color: #ffff00;">==========================================================================</span><br>由于elk-node1和elk-node2两台是虚拟机，没有外网ip，所以访问需要通过宿主机进行代理转发实现。</p>
<p><strong><span style="color: #800000;">有以下两种转发设置：（任选其一）</span></strong></p>
<p><span style="color: #0000ff;">通过访问宿主机的19200,19201端口分别转发到elk-node1,elk-node2的9200端口<br>通过访问宿主机的15601端口转发到elk-node1的5601端口</span></p>
<p><span style="color: #008000;">宿主机：112.110.115.10</span>(内网ip为192.168.1.7) &nbsp;<span style="color: #008000;">（为了不让线上的真实ip暴露，这里任意给了一个ip做记录）</span></p>
<p><span style="background-color: #ff99cc;">a）通过宿主机的haproxy服务进行代理转发，如下是宿主机上的代理配置：</span></p>
<p>[root@kvm-server conf]# pwd<br>/usr/local/haproxy/conf<br>[root@kvm-server conf]# cat haproxy.cfg<br>..........<br>..........<br>listen node1-9200 0.0.0.0:19200<br>    mode tcp<br>    option tcplog<br>    balance roundrobin<br>    server 192.168.1.160 192.168.1.160:9200 weight 1 check inter 1s rise 2 fall 2</p>
<p>listen node2-9200 0.0.0.0:19201<br>    mode tcp<br>    option tcplog<br>    balance roundrobin<br>    server 192.168.1.161 192.168.1.161:9200 weight 1 check inter 1s rise 2 fall 2</p>
<p>listen node1-5601 0.0.0.0:15601<br>    mode tcp<br>    option tcplog<br>    balance roundrobin<br>    server 192.168.1.160 192.168.1.160:5601 weight 1 check inter 1s rise 2 fall 2</p>
<p>重启haproxy服务<br>[root@kvm-server conf]# /etc/init.d/haproxy restart</p>
<p>设置宿主机防火墙<br>[root@kvm-server conf]# cat /etc/sysconfig/iptables<br>.........<br>-A INPUT -p tcp -m state --state NEW -m tcp --dport 19200 -j ACCEPT<br>-A INPUT -p tcp -m state --state NEW -m tcp --dport 19201 -j ACCEPT <br>-A INPUT -p tcp -m state --state NEW -m tcp --dport 15601 -j ACCEPT</p>
<p>[root@kvm-server conf]# /etc/init.d/iptables restart</p>
<p><span style="background-color: #ff99cc;">b）通过宿主机的NAT端口转发实现</span></p>
<p>[root@kvm-server conf]# iptables -t nat -A PREROUTING -p tcp -m tcp --dport 19200 -j DNAT --to-destination 192.168.1.160:9200<br>[root@kvm-server conf]# iptables -t nat -A POSTROUTING -d 192.168.1.160/32 -p tcp -m tcp --sport 9200 -j SNAT --to-source 192.168.1.7<br>[root@kvm-server conf]# iptables -t filter -A INPUT -p tcp -m state --state NEW -m tcp --dport 19200 -j ACCEPT</p>
<p>[root@kvm-server conf]# iptables -t nat -A PREROUTING -p tcp -m tcp --dport 19201 -j DNAT --to-destination 192.168.1.161:9200<br>[root@kvm-server conf]# iptables -t nat -A POSTROUTING -d 192.168.1.161/32 -p tcp -m tcp --sport 9200 -j SNAT --to-source 192.168.1.7<br>[root@kvm-server conf]# iptables -t filter -A INPUT -p tcp -m state --state NEW -m tcp --dport 19201 -j ACCEPT</p>
<p>[root@kvm-server conf]# iptables -t nat -A PREROUTING -p tcp -m tcp --dport 15601 -j DNAT --to-destination 192.168.1.160:5601<br>[root@kvm-server conf]# iptables -t nat -A POSTROUTING -d 192.168.1.160/32 -p tcp -m tcp --sport 5601 -j SNAT --to-source 192.168.1.7<br>[root@kvm-server conf]# iptables -t filter -A INPUT -p tcp -m state --state NEW -m tcp --dport 15601 -j ACCEPT</p>
<p>[root@kvm-server conf]# service iptables save<br>[root@kvm-server conf]# service iptables restart</p>
<p>提醒一点：<br>nat端口转发设置成功后，/etc/sysconfig/iptables文件里要注释掉下面两行！不然nat转发会有问题！一般如上面在nat转发规则设置好并save和restart防火墙之后就会自动在/etc/sysconfig/iptables文件里删除掉下面两行内容了。<br>[root@kvm-server conf]# vim /etc/sysconfig/iptables<br>..........<br>#-A INPUT -j REJECT --reject-with icmp-host-prohibited <br>#-A FORWARD -j REJECT --reject-with icmp-host-prohibited<br>[root@linux-node1 ~]# service iptables restart</p>
<p><span style="color: #ff00ff; background-color: #ffff00;">=============================================================</span></p>
<p><span style="background-color: #ffcc99;">（1）Elasticsearch安装配置</span></p>
<p><span style="background-color: #cc99ff;">基础环境安装（elk-node1和elk-node2同时操作）</span></p>
<p><span style="background-color: #ccffff;">1）下载并安装GPG Key</span><br>[root@elk-node1 ~]# rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</p>
<p><span style="background-color: #ccffff;">2）添加yum仓库</span><br>[root@elk-node1 ~]# vim /etc/yum.repos.d/elasticsearch.repo<br>[elasticsearch-2.x]<br>name=Elasticsearch repository for 2.x packages<br>baseurl=http://packages.elastic.co/elasticsearch/2.x/centos<br>gpgcheck=1<br>gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch<br>enabled=1</p>
<p><span style="background-color: #ccffff;">3）安装elasticsearch</span><br>[root@elk-node1 ~]# yum install -y elasticsearch</p>
<p><span style="background-color: #ccffff;">4）安装相关测试软件</span><br>#提前先下载安装epel源：epel-release-latest-7.noarch.rpm，否则yum会报错:No Package.....<br>[root@elk-node1 ~]# wget http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<br>[root@elk-node1 ~]# rpm -ivh epel-release-latest-7.noarch.rpm<br>#安装Redis<br>[root@elk-node1 ~]# yum install -y redis<br>#安装Nginx<br>[root@elk-node1 ~]# yum install -y nginx<br>#安装java<br>[root@elk-node1 ~]# yum install -y java</p>
<p>安装完java后，检测<br>[root@elk-node1 ~]# java -version<br>openjdk version "1.8.0_102"<br>OpenJDK Runtime Environment (build 1.8.0_102-b14)<br>OpenJDK 64-Bit Server VM (build 25.102-b14, mixed mode)</p>
<p><span style="background-color: #cc99ff;">配置部署（下面先进行elk-node1的配置）</span></p>
<p><span style="background-color: #ccffff;">1）配置修改配置文件</span><br>[root@elk-node1 ~]# mkdir -p /data/es-data<br>[root@elk-node1 ~]# vim /etc/elasticsearch/elasticsearch.yml &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 【将里面内容情况，配置下面内容】<br>cluster.name: huanqiu &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong><span style="color: #339966;"># 组名（同一个组，组名必须一致）</span></strong><br>node.name: elk-node1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong><span style="color: #339966;"># 节点名称，建议和主机名一致</span></strong><br>path.data: /data/es-data &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <strong><span style="color: #339966;"># 数据存放的路径</span></strong><br>path.logs: /var/log/elasticsearch/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <strong><span style="color: #339966;"># 日志存放的路径</span></strong><br>bootstrap.mlockall: true &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong><span style="color: #339966;"> # 锁住内存，不被使用到交换分区去</span></strong><br>network.host: 0.0.0.0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong><span style="color: #339966;"># 网络设置</span></strong><br>http.port: 9200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #339966;"><strong># 端口</strong></span></p>
<p><span style="background-color: #ccffff;">2）启动并查看</span><br>[root@elk-node1 ~]# chown  -R elasticsearch.elasticsearch /data/<br>[root@elk-node1 ~]# systemctl  start elasticsearch<br>[root@elk-node1 ~]# systemctl  status elasticsearch<br> CGroup: /system.slice/elasticsearch.service<br>           └─3005 /bin/java -Xms<span style="color: #ff0000;">256m</span> -Xmx<span style="color: #ff0000;">1g</span> -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSI...</p>
<p><span style="color: #993300;"><strong>注意：上面可以看出elasticsearch设置的内存最小256m，最大1g</strong></span></p>
<p><span style="color: #0000ff; background-color: #ffff99;">=====================温馨提示:&nbsp; Elasticsearch启动出现"could not find java"===================</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_268482" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">yum方法安装elasticsearch, 使用</code><code class="bash string">"systemctl start elasticsearch"</code><code class="bash plain">启动服务失败.</code></div><div class="line number2 index1 alt1"><code class="bash string">"systemctl status elasticsearch"</code><code class="bash plain">查看, 发现报错说could not </code><code class="bash functions">find</code> <code class="bash plain">java</code></div><div class="line number3 index2 alt2"><code class="bash plain">但是</code><code class="bash string">"java -version"</code> <code class="bash plain">查看发现java已经安装了</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="bash plain">这是因为elasticsearch在启动过程中, 引用的java路径找不到</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="bash plain">解决办法: 在elasticsearch配置文件中定义java全路径</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="bash plain">[root@elk-node01 ~]</code><code class="bash comments"># java -version</code></div><div class="line number10 index9 alt1"><code class="bash plain">java version </code><code class="bash string">"1.8.0_131"</code></div><div class="line number11 index10 alt2"><code class="bash plain">Java(TM) SE Runtime Environment (build 1.8.0_131-b11)</code></div><div class="line number12 index11 alt1"><code class="bash plain">Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="bash plain">[root@elk-node01 ~]</code><code class="bash comments"># find / -name java</code></div><div class="line number15 index14 alt2"><code class="bash plain">/var/lib/alternatives/java</code></div><div class="line number16 index15 alt1"><code class="bash plain">/usr/share/swig/2</code><code class="bash plain">.0.10</code><code class="bash plain">/java</code></div><div class="line number17 index16 alt2"><code class="bash plain">/usr/java</code></div><div class="line number18 index17 alt1"><code class="bash plain">/usr/java/jdk1</code><code class="bash plain">.8.0_131</code><code class="bash plain">/bin/java</code></div><div class="line number19 index18 alt2"><code class="bash plain">/usr/java/jdk1</code><code class="bash plain">.8.0_131</code><code class="bash plain">/jre/bin/java</code></div><div class="line number20 index19 alt1"><code class="bash plain">/usr/bin/java</code></div><div class="line number21 index20 alt2"><code class="bash plain">/etc/pki/java</code></div><div class="line number22 index21 alt1"><code class="bash plain">/etc/pki/ca-trust/extracted/java</code></div><div class="line number23 index22 alt2"><code class="bash plain">/etc/alternatives/java</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="bash plain">[root@elk-node01 ~]</code><code class="bash comments"># vim /etc/sysconfig/elasticsearch</code></div><div class="line number26 index25 alt1"><code class="bash plain">添加JAVA_HOME环境变量的配置</code></div><div class="line number27 index26 alt2"><code class="bash plain">JAVA_HOME=</code><code class="bash plain">/usr/java/jdk1</code><code class="bash plain">.8.0_131</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>[root@linux-node1 src]# netstat -antlp |egrep "9200|9300"<br>tcp6       0      0 :::9200                 :::*                    LISTEN      3005/java           <br>tcp6       0      0 :::9300                 :::*                    LISTEN      3005/java</p>
<p>然后通过web访问<span style="color: #0000ff;">（访问的浏览器最好用google浏览器）</span></p>
<p>http://112.110.115.10:19200/</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107154110452-1816383269.png" alt=""></p>
<p><span style="background-color: #ccffff;">3）通过命令的方式查看数据（在112.110.115.10宿主机或其他外网服务器上查看，如下）</span><br>[root@kvm-server src]# <span style="color: #0000ff;">curl -i -XGET 'http://192.168.1.160:9200/_count?pretty' -d '{"query":{"match_all":{}}}'</span><br>HTTP/1.1 200 OK<br>Content-Type: application/json; charset=UTF-8<br>Content-Length: 95</p>
<p>{<br>"count" : 0,<br>"_shards" : {<br>"total" : 0,<br>"successful" : 0,<br>"failed" : 0<br>}<br>}</p>
<p>这样感觉用命令来查看，特别的不爽。</p>
<p><span style="background-color: #ccffff;">4）接下来安装插件，使用插件进行查看~ &nbsp;（下面两个插件要在elk-node1和elk-node2上都要安装）</span><br><strong><span style="color: #993366;">4.1）安装head插件</span></strong><br><span style="background-color: #ffff00;">==================================================================</span><br><span style="background-color: #ffff00;">a)插件安装方法一</span><br>[root@elk-node1 src]# /usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head</p>
<p><span style="background-color: #ffff00;">b）插件安装方法二</span><br>首先下载head插件，下载到/usr/loca/src目录下<br>下载地址：https://github.com/mobz/elasticsearch-head</p>
<p>======================================================<br>head插件包百度云盘下载：https://pan.baidu.com/s/1boBE0qj<br>提取密码：ifj7<br>======================================================</p>
<p>[root@elk-node1 src]# unzip elasticsearch-head-master.zip<br>[root@elk-node1 src]# ls<br>elasticsearch-head-master elasticsearch-head-master.zip</p>
<p>在/usr/share/elasticsearch/plugins目录下创建head目录<br>然后将上面下载的elasticsearch-head-master.zip解压后的文件都移到/usr/share/elasticsearch/plugins/head下<br>接着重启elasticsearch服务即可！<br>[root@elk-node1 src]# cd /usr/share/elasticsearch/plugins/<br>[root@elk-node1 plugins]# mkdir head<br>[root@elk-node1 plugins]# ls<br>head<br>[root@elk-node1 plugins]# cd head<br>[root@elk-node1 head]# cp -r /usr/local/src/elasticsearch-head-master/* ./<br>[root@elk-node1 head]# pwd<br>/usr/share/elasticsearch/plugins/head</p>
<p>[root@elk-node1 head]# chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/plugins<br>[root@elk-node1 head]# ll<br>total 40<br>-rw-r--r--. 1 elasticsearch elasticsearch 104 Sep 28 01:57 elasticsearch-head.sublime-project<br>-rw-r--r--. 1 elasticsearch elasticsearch 2171 Sep 28 01:57 Gruntfile.js<br>-rw-r--r--. 1 elasticsearch elasticsearch 3482 Sep 28 01:57 grunt_fileSets.js<br>-rw-r--r--. 1 elasticsearch elasticsearch 1085 Sep 28 01:57 index.html<br>-rw-r--r--. 1 elasticsearch elasticsearch 559 Sep 28 01:57 LICENCE<br>-rw-r--r--. 1 elasticsearch elasticsearch 795 Sep 28 01:57 package.json<br>-rw-r--r--. 1 elasticsearch elasticsearch 100 Sep 28 01:57 plugin-descriptor.properties<br>-rw-r--r--. 1 elasticsearch elasticsearch 5211 Sep 28 01:57 README.textile<br>drwxr-xr-x. 5 elasticsearch elasticsearch 4096 Sep 28 01:57 _site<br>drwxr-xr-x. 4 elasticsearch elasticsearch 29 Sep 28 01:57 src<br>drwxr-xr-x. 4 elasticsearch elasticsearch 66 Sep 28 01:57 test</p>
<p>[root@elk-node1 _site]# systemctl restart elasticsearch<br><span style="background-color: #ffff00;">=========================================================================</span></p>
<p>插件访问<span style="color: #993300;">（最好提前将elk-node2节点的配置和插件都安装后，再来进行访问和数据插入测试）</span><br><span style="color: #0000ff;">http://112.110.115.10:19200/_plugin/head/</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107170112186-473456625.png" alt=""></p>
<p>先插入数据实例，测试下<br>如下：打开”复合查询“，在POST选项下，任意输入如/index-demo/test,然后在下面输入数据<span style="color: #0000ff;">（注意内容之间换行的逗号不要漏掉）</span>；<br>数据输入好之后<span style="color: #0000ff;">(如下输入wangshibo；hello world内容)</span>，下面点击”验证JSON“-&gt;”提交请求“，提交成功后，观察右栏里出现的信息：有index，type，version等信息，failed:0（成功消息）</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107174518983-1579095831.png" alt=""></p>
<p>再查看测试实例，如下：<br>"复合查询"下，<span style="color: #0000ff;">选择GET选项</span>，<span style="color: #0000ff;">在/index-demo/test/后面输入上面POST结果中的id号</span>，<span style="color: #0000ff;">不输入内容，即{}括号里为空</span>！<br>然后点击”验证JSON“-&gt;"提交请求"，观察右栏内就有了上面插入的数据了（即wangshibo，hello world）</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107174656592-1167145337.png" alt=""></p>
<p>打开<span style="color: #0000ff;">"基本查询"</span>，查看下数据，如下，即可查询到上面插入的数据：</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107174927280-1405859225.png" alt=""></p>
<p>打开“数据浏览”，也能查看到插入的数据：</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107175017999-77664308.png" alt=""></p>
<p><span style="color: #0000ff;">如下：一定要提前在elk-node2节点上也完成配置（配置内容在下面提到），否则上面插入数据后，集群状态会呈现黄色yellow状态，elk-node2完成配置加入到集群里后就会恢复到正常的绿色状态。</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107180936092-1235516215.png" alt=""></p>
<p><span style="color: #993366;"><strong>4.2）安装kopf监控插件</strong></span><br><span style="background-color: #ffff00;">==========================================================================</span></p>
<p><span style="background-color: #ffff00;">a）监控插件安装方法一</span></p>
<p>[root@elk-node1 src]# /usr/share/elasticsearch/bin/plugin install lmenezes/elasticsearch-kopf<br> </p>
<p><span style="background-color: #ffff00;">b）监控插件安装方法二</span></p>
<p>首先下载监控插件kopf，下载到/usr/loca/src目录下<br>下载地址：https://github.com/lmenezes/elasticsearch-kopf</p>
<p>====================================================<br>kopf插件包百度云盘下载：https://pan.baidu.com/s/1qYixSL2<br>提取密码：ya4t<br>===================================================</p>
<p>[root@elk-node1 src]# unzip elasticsearch-kopf-master.zip<br>[root@elk-node1 src]# ls<br>elasticsearch-kopf-master elasticsearch-kopf-master.zip</p>
<p>在/usr/share/elasticsearch/plugins目录下创建kopf目录<br>然后将上面下载的elasticsearch-kopf-master.zip解压后的文件都移到/usr/share/elasticsearch/plugins/kopf下<br>接着重启elasticsearch服务即可！<br>[root@elk-node1 src]# cd /usr/share/elasticsearch/plugins/<br>[root@elk-node1 plugins]# mkdir kopf<br>[root@elk-node1 plugins]# cd kopf<br>[root@elk-node1 kopf]# cp -r /usr/local/src/elasticsearch-kopf-master/* ./<br>[root@elk-node1 kopf]# pwd<br>/usr/share/elasticsearch/plugins/kopf</p>
<p>[root@elk-node1 kopf]# chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/plugins<br>[root@elk-node1 kopf]# ll<br>total 40<br>-rw-r--r--. 1 elasticsearch elasticsearch 237 Sep 28 16:28 CHANGELOG.md<br>drwxr-xr-x. 2 elasticsearch elasticsearch 22 Sep 28 16:28 dataset<br>drwxr-xr-x. 2 elasticsearch elasticsearch 73 Sep 28 16:28 docker<br>-rw-r--r--. 1 elasticsearch elasticsearch 4315 Sep 28 16:28 Gruntfile.js<br>drwxr-xr-x. 2 elasticsearch elasticsearch 4096 Sep 28 16:28 imgs<br>-rw-r--r--. 1 elasticsearch elasticsearch 1083 Sep 28 16:28 LICENSE<br>-rw-r--r--. 1 elasticsearch elasticsearch 1276 Sep 28 16:28 package.json<br>-rw-r--r--. 1 elasticsearch elasticsearch 102 Sep 28 16:28 plugin-descriptor.properties<br>-rw-r--r--. 1 elasticsearch elasticsearch 3165 Sep 28 16:28 README.md<br>drwxr-xr-x. 6 elasticsearch elasticsearch 4096 Sep 28 16:28 _site<br>drwxr-xr-x. 4 elasticsearch elasticsearch 27 Sep 28 16:28 src<br>drwxr-xr-x. 4 elasticsearch elasticsearch 4096 Sep 28 16:28 tests</p>
<p>[root@elk-node1 _site]# systemctl restart elasticsearch</p>
<p><span style="background-color: #ffff99; color: #0000ff;">============================================================================</span></p>
<p>访问插件：<span style="color: #993300;">（如下，同样要提前安装好elk-node2节点上的插件，否则访问时会出现集群节点为黄色的yellow告警状态）</span></p>
<p><span style="color: #0000ff;">http://112.110.115.10:19200/_plugin/kopf/#!/cluster</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107183909264-1134591415.png" alt=""></p>
<p><span style="background-color: #cc99ff;">*************************************************************************</span><br><span style="background-color: #cc99ff;">下面进行节点elk-node2的配置 &nbsp;（如上的两个插件也在elk-node2上同样安装）</span></p>
<p>注释：其实两个的安装配置基本上是一样的。</p>
<p>[root@elk-node2 src]# mkdir -p /data/es-data   <br>[root@elk-node2 ~]# cat /etc/elasticsearch/elasticsearch.yml<br>cluster.name: huanqiu        <br>node.name: elk-node2<br>path.data: /data/es-data <br>path.logs: /var/log/elasticsearch/ <br>bootstrap.mlockall: true <br>network.host: 0.0.0.0  <br>http.port: 9200        <br>discovery.zen.ping.multicast.enabled: false<br>discovery.zen.ping.unicast.hosts: ["192.168.1.160", "192.168.1.161"]</p>
<p># 修改权限配置<br>[root@elk-node2 src]# chown -R elasticsearch.elasticsearch /data/</p>
<p># 启动服务<br>[root@elk-node2 src]# systemctl start elasticsearch<br>[root@elk-node2 src]# systemctl status elasticsearch<br>● elasticsearch.service - Elasticsearch<br>   Loaded: loaded (/usr/lib/systemd/system/elasticsearch.service; enabled; vendor preset: disabled)<br>   Active: active (running) since Wed 2016-09-28 16:49:41 CST; 1 weeks 3 days ago<br>     Docs: http://www.elastic.co<br>  Process: 17798 ExecStartPre=/usr/share/elasticsearch/bin/elasticsearch-systemd-pre-exec (code=exited, status=0/SUCCESS)<br> Main PID: 17800 (java)<br>   CGroup: /system.slice/elasticsearch.service<br>           └─17800 /bin/java -Xms256m -Xmx1g -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFra...</p>
<p>Oct 09 13:42:22 elk-node2 elasticsearch[17800]: [2016-10-09 13:42:22,295][WARN ][transport                ] [elk-node2] Transport res...943817]<br>Oct 09 13:42:23 elk-node2 elasticsearch[17800]: [2016-10-09 13:42:23,111][WARN ][transport                ] [elk-node2] Transport res...943846]<br>................<br>................</p>
<p># 查看端口<br>[root@elk-node2 src]# netstat -antlp|egrep "9200|9300"<br>tcp6       0      0 :::9200                 :::*                    LISTEN      2928/java           <br>tcp6       0      0 :::9300                 :::*                    LISTEN      2928/java           <br>tcp6       0      0 127.0.0.1:48200         127.0.0.1:9300          TIME_WAIT   -                   <br>tcp6       0      0 ::1:41892               ::1:9300                TIME_WAIT   -<br>*************************************************************************</p>
<p><span style="color: #800000;">通过命令的方式查看elk-node2数据（在112.110.115.10宿主机或其他外网服务器上查看，如下）</span><br>[root@kvm-server ~]# <span style="color: #0000ff;">curl -i -XGET 'http://192.168.1.161:9200/_count?pretty' -d '{"query":{"match_all":{}}}'</span><br>HTTP/1.1 200 OK<br>Content-Type: application/json; charset=UTF-8<br>Content-Length: 95</p>
<p>{<br>  "count" : 1,<br>  "_shards" : {<br>    "total" : 5,<br>    "successful" : 5,<br>    "failed" : 0<br>  }</p>
<p>然后通过web访问elk-node2<br><span style="color: #0000ff;">http://112.110.115.10:19201/</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107185117186-1904781309.png" alt=""></p>
<p>访问两个插件：<br><span style="color: #0000ff;">http://112.110.115.10:19201/_plugin/head/</span><br><span style="color: #0000ff;">http://112.110.115.10:19201/_plugin/kopf/#!/cluster</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107185153499-963214969.png" alt=""></p>
<p>&nbsp;<img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161107185244420-656065592.png" alt=""></p>
<p><span style="background-color: #ffcc99;">&nbsp;（2）Logstash安装配置（这个在客户机上是要安装的。elk-node1和elk-node2都安装）</span></p>
<p><span style="background-color: #cc99ff;">基础环境安装（客户端安装logstash，<span style="color: #000000; background-color: #ffff99;"><strong>收集到的数据写入到elasticsearch里，就可以登陆logstash界面查看到了</strong></span>）</span></p>
<p><span style="background-color: #ccffff;">1）下载并安装GPG Key</span><br>[root@elk-node1 ~]# rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</p>
<p><span style="background-color: #ccffff;">2）添加yum仓库</span><br>[root@hadoop-node1 ~]# vim /etc/yum.repos.d/logstash.repo<br>[logstash-2.1]<br>name=Logstash repository for 2.1.x packages<br>baseurl=http://packages.elastic.co/logstash/2.1/centos<br>gpgcheck=1<br>gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch<br>enabled=1</p>
<p><span style="background-color: #ccffff;">3）安装logstash</span><br>[root@elk-node1 ~]# yum install -y logstash</p>
<p><span style="background-color: #ccffff;">4）logstash启动</span><br>[root@elk-node1 ~]# systemctl start elasticsearch<br>[root@elk-node1 ~]# systemctl status elasticsearch<br>● elasticsearch.service - Elasticsearch<br>   Loaded: loaded (/usr/lib/systemd/system/elasticsearch.service; disabled; vendor preset: disabled)<br>   Active: active (running) since Mon 2016-11-07 18:33:28 CST; 3 days ago<br>     Docs: http://www.elastic.co<br> Main PID: 8275 (java)<br>   CGroup: /system.slice/elasticsearch.service<br>           └─8275 /bin/java -Xms256m -Xmx1g -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFrac...<br>..........<br>..........</p>
<p><span style="background-color: #cc99ff;">数据的测试</span></p>
<p><span style="background-color: #ccffff;">1）基本的输入输出</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -e 'input { stdin{} } output { stdout{} }'<br>Settings: Default filter workers: 1<br>Logstash startup completed<br>hello &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">#输入这个</span><br>2016-11-11T06:41:07.690Z elk-node1 hello &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #008000;">#输出这个</span><br>wangshibo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #008000;">#输入这个</span><br>2016-11-11T06:41:10.608Z elk-node1 wangshibo &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">#输出这个</span></p>
<p><span style="background-color: #ccffff;">2）使用rubydebug详细输出</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -e 'input { stdin{} } output { stdout{ codec =&gt; rubydebug} }'<br>Settings: Default filter workers: 1<br>Logstash startup completed<br><span style="color: #993300;">hello &nbsp;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #008000;">#输入这个</span><br>{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">#输出下面信息</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"message" =&gt; "hello",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"@version" =&gt; "1",<br>&nbsp; &nbsp; &nbsp; "@timestamp" =&gt; "2016-11-11T06:44:06.711Z",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "host" =&gt; "elk-node1"<br>}<br><span style="color: #993300;">wangshibo</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">#输入这个</span><br>{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">#输出下面信息</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"message" =&gt; "wangshibo",<br>&nbsp; &nbsp; &nbsp; &nbsp; "@version" =&gt; "1",<br>&nbsp; &nbsp;"@timestamp" =&gt; "2016-11-11T06:44:11.270Z",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"host" =&gt; "elk-node1"<br>}</p>
<p><span style="background-color: #ccffff;">3) 把内容写到elasticsearch中</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -e 'input { stdin{} } output { elasticsearch { hosts =&gt; ["192.168.1.160:9200"]} }'<br>Settings: Default filter workers: 1<br>Logstash startup completed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style="color: #008000; background-color: #ffffff;">#输入下面的测试数据</span><br><span style="color: #993300;">123456                            </span><br><span style="color: #993300;">wangshibo</span><br><span style="color: #993300;">huanqiu</span><br><span style="color: #993300;">hahaha</span></p>
<p><span style="background-color: #ff99cc;">使用rubydebug和写到elasticsearch中的区别：其实就在于后面标准输出的区别，前者使用codec；后者使用elasticsearch</span></p>
<p>写到elasticsearch中在logstash中查看，如下图：<br><span style="color: #ff0000;">注意：</span><br><span style="color: #ff0000;">master收集到日志后，会把一部分数据碎片到salve上（随机的一部分数据），master和slave又都会各自做副本，并把副本放到对方机器上，这样就保证了数据不会丢失。</span><br><span style="color: #ff0000; background-color: #ffff99;">如下，master收集到的数据放到了自己的第1,3分片上，其他的放到了slave的第0,2,4分片上。</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111150758108-1316549559.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111151545170-900394314.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111151649014-1867187235.png" alt=""></p>
<p><span style="background-color: #ccffff;">4）即写到elasticsearch中又写在文件中一份</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -e 'input { stdin{} } output { elasticsearch { hosts =&gt; ["192.168.1.160:9200"]} stdout{ codec =&gt; rubydebug}}'<br>Settings: Default filter workers: 1<br>Logstash startup completed<br><span style="color: #993300;">huanqiupc</span><br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"message" =&gt; "huanqiupc",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "@version" =&gt; "1",<br>&nbsp; &nbsp; &nbsp;"@timestamp" =&gt; "2016-11-11T07:27:42.012Z",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"host" =&gt; "elk-node1"<br>}<br><span style="color: #993300;">wangshiboqun</span><br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"message" =&gt; "wangshiboqun",<br>&nbsp; &nbsp; &nbsp; &nbsp; "@version" =&gt; "1",<br>&nbsp; &nbsp;"@timestamp" =&gt; "2016-11-11T07:27:55.396Z",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"host" =&gt; "elk-node1"<br>}</p>
<p><span style="color: #0000ff;">以上文本可以长期保留、操作简单、压缩比大。下面登陆elasticsearch界面中查看;</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111153314124-156728783.png" alt=""></p>
<p><span style="background-color: #cc99ff;">&nbsp;logstash的配置和文件的编写</span></p>
<p><span style="background-color: #ccffff;">1）logstash的配置</span><br>简单的配置方式：<br>[root@elk-node1 ~]# vim /etc/logstash/conf.d/01-logstash.conf<br>input { stdin { } }<br>output {<br>&nbsp; &nbsp; &nbsp; &nbsp; elasticsearch { hosts =&gt; ["192.168.1.160:9200"]}<br>&nbsp; &nbsp; &nbsp; &nbsp; stdout { codec =&gt; rubydebug }<br>}</p>
<p>它的执行：<br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f /etc/logstash/conf.d/01-logstash.conf<br>Settings: Default filter workers: 1<br>Logstash startup completed<br>beijing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #008000;">#输入内容</span><br>{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">#输出下面信息</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"message" =&gt; "beijing",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "@version" =&gt; "1",<br>&nbsp; &nbsp; &nbsp; &nbsp;"@timestamp" =&gt; "2016-11-11T07:41:48.401Z",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"host" =&gt; "elk-node1"<br>}</p>
<p><span style="background-color: #ffff99; color: #0000ff;">===============================================================</span><br><span style="color: #ff0000;">参考内容：</span><br>https://www.elastic.co/guide/en/logstash/current/configuration.html <br>https://www.elastic.co/guide/en/logstash/current/configuration-file-structure.html<br><span style="background-color: #ffff99; color: #0000ff;">===============================================================</span></p>
<p><span style="background-color: #ffffff;"><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111154419514-792115664.png" alt=""></span></p>
<p><span style="background-color: #ccffff;">2）收集系统日志</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_34292" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim&nbsp; file.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/messages"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number8 index7 alt1"><code class="cpp plain">}</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="cpp plain">output {</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"system-%{+YYYY.MM.dd}"</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number15 index14 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行上面日志信息的收集，如下，这个命令会一直在执行中，表示日志在监控收集中；如果中断，就表示日志不在收集！所以需要放在后台执行~</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f file.conf &amp;</p>
<p><span style="color: #0000ff;">登陆elasticsearch界面，查看本机系统日志的信息：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111155327702-79625039.png" alt=""></p>
<p>&nbsp;</p>
<p>&nbsp;<img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111155536670-511113028.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111155604889-15293116.png" alt=""></p>
<p><span style="background-color: #ffff99; color: #0000ff;">================================================================</span><br>参考内容：<br>https://www.elastic.co/guide/en/logstash/current/plugins-outputs-elasticsearch.html<br><span style="background-color: #ffff99; color: #0000ff;">================================================================</span></p>
<p><span style="background-color: #ccffcc;">3）收集java日志，其中包含上面讲到的日志收集</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_384802" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim&nbsp; file.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/messages"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number8 index7 alt1"><code class="cpp plain">}</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="cpp plain">input {</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/elasticsearch/huanqiu.log"</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"es-error"</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number16 index15 alt1"><code class="cpp plain">}</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="cpp plain">output {</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"system"</code><code class="cpp plain">{</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"system-%{+YYYY.MM.dd}"</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"es-error"</code><code class="cpp plain">{</code></div><div class="line number29 index28 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"es-error-%{+YYYY.MM.dd}"</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number34 index33 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ff99cc;">注意：</span><br><span style="background-color: #ff99cc;">如果你的日志中有type字段 那你就不能在conf文件中使用type</span></p>
<p><span style="color: #0000ff;">执行如下命令收集：</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f file.conf &amp;</p>
<p><span style="color: #0000ff;">登陆elasticsearch界面，查看数据：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111161603842-1419673777.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111161649045-1840765035.png" alt=""></p>
<p><span style="background-color: #ffff99; color: #0000ff;">====================================================================</span><br>参考内容：<br>https://www.elastic.co/guide/en/logstash/current/event-dependent-configuration.html<br><span style="background-color: #ffff99; color: #0000ff;">====================================================================</span></p>
<p><span style="color: #0000ff;">有个问题： </span><br><span style="color: #0000ff;">每个报错都给收集成一行了，不是按照一个报错，一个事件模块收集的。</span></p>
<p><strong><span style="color: #ff00ff;">下面将行换成事件的方式展示：</span></strong></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_330161" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim multiline.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">stdin {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; multiline {</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pattern =&gt; </code><code class="cpp string">"^\["</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">negate =&gt; </code><code class="cpp keyword bold">true</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">what =&gt; </code><code class="cpp string">"previous"</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number10 index9 alt1"><code class="cpp plain">}</code></div><div class="line number11 index10 alt2"><code class="cpp plain">output {</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">stdout {</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; </code><code class="cpp string">"rubydebug"</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}&nbsp; </code></div><div class="line number15 index14 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行命令：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_8952" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f multiline.conf </code></div><div class="line number2 index1 alt1"><code class="cpp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="cpp plain">Logstash startup completed</code></div><div class="line number4 index3 alt1"><code class="cpp plain">123</code></div><div class="line number5 index4 alt2"><code class="cpp plain">456</code></div><div class="line number6 index5 alt1"><code class="cpp plain">[123</code></div><div class="line number7 index6 alt2"><code class="cpp plain">{</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@timestamp"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"2016-11-11T09:28:56.824Z"</code><code class="cpp plain">,</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"message"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"123\n456"</code><code class="cpp plain">,</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@version"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"1"</code><code class="cpp plain">,</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"tags"</code> <code class="cpp plain">=&gt; [</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">[0] </code><code class="cpp string">"multiline"</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">],</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"host"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"elk-node1"</code></div><div class="line number15 index14 alt2"><code class="cpp plain">}</code></div><div class="line number16 index15 alt1"><code class="cpp plain">123]</code></div><div class="line number17 index16 alt2"><code class="cpp plain">[456]</code></div><div class="line number18 index17 alt1"><code class="cpp plain">{</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@timestamp"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"2016-11-11T09:29:09.043Z"</code><code class="cpp plain">,</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"message"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"[123\n123]"</code><code class="cpp plain">,</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@version"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"1"</code><code class="cpp plain">,</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"tags"</code> <code class="cpp plain">=&gt; [</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">[0] </code><code class="cpp string">"multiline"</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">],</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"host"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"elk-node1"</code></div><div class="line number26 index25 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">在没有遇到<strong><span style="color: #ff0000;">[</span></strong>的时候，系统不会收集，只有遇见[的时候，才算是一个事件，才收集起来。</span><br><span style="background-color: #ffff99; color: #0000ff;">======================================================================</span><br>参考内容<br>https://www.elastic.co/guide/en/logstash/current/plugins-codecs-multiline.html<br><span style="background-color: #ffff99; color: #0000ff;">======================================================================</span></p>
<p><span style="background-color: #ffcc99;">（3）Kibana安装配置</span></p>
<p><span style="background-color: #ccffff;">1）kibana的安装：</span><br>[root@elk-node1 ~]# cd /usr/local/src<br>[root@elk-node1 src]# wget https://download.elastic.co/kibana/kibana/kibana-4.3.1-linux-x64.tar.gz<br>[root@elk-node1 src]# tar zxf kibana-4.3.1-linux-x64.tar.gz<br>[root@elk-node1 src]# mv kibana-4.3.1-linux-x64 /usr/local/<br>[root@elk-node1 src]# ln -s /usr/local/kibana-4.3.1-linux-x64/ /usr/local/kibana</p>
<p><span style="background-color: #ccffff;">2）修改配置文件：</span><br>[root@elk-node1 config]# pwd<br>/usr/local/kibana/config<br>[root@elk-node1 config]# cp kibana.yml kibana.yml.bak<br>[root@elk-node1 config]# vim kibana.yml <br><span style="color: #993300;">server.port: 5601</span><br><span style="color: #993300;">server.host: "0.0.0.0"</span><br><span style="color: #993300;">elasticsearch.url: "http://192.168.1.160:9200"</span><br><span style="color: #993300;">kibana.index: ".kibana"&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><strong><span style="color: #ff00ff;">#注意这个.Kibana索引用来存储数据，千万不要删除了它。它是将es数据通过kibana进行web展示的关键。这个配置后，在es的web界面里就会看到这个.kibana索引。</span></strong></p>
<p><span style="color: #0000ff;">因为他一直运行在前台，要么选择开一个窗口，要么选择使用screen。</span><br><span style="color: #0000ff;">安装并使用screen启动kibana：</span><br>[root@elk-node1 ~]# yum -y install screen<br>[root@elk-node1 ~]# screen &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #008000;">＃这样就另开启了一个终端窗口</span><br>[root@elk-node1 ~]# /usr/local/kibana/bin/kibana<br>  log   [18:23:19.867] [info][status][plugin:kibana] Status changed from uninitialized to green - Ready<br>  log   [18:23:19.911] [info][status][plugin:elasticsearch] Status changed from uninitialized to yellow - Waiting for Elasticsearch<br>  log   [18:23:19.941] [info][status][plugin:kbn_vislib_vis_types] Status changed from uninitialized to green - Ready<br>  log   [18:23:19.953] [info][status][plugin:markdown_vis] Status changed from uninitialized to green - Ready<br>  log   [18:23:19.963] [info][status][plugin:metric_vis] Status changed from uninitialized to green - Ready<br>  log   [18:23:19.995] [info][status][plugin:spyModes] Status changed from uninitialized to green - Ready<br>  log   [18:23:20.004] [info][status][plugin:statusPage] Status changed from uninitialized to green - Ready<br>  log   [18:23:20.010] [info][status][plugin:table_vis] Status changed from uninitialized to green - Ready</p>
<p><strong><span style="color: #ff00ff;">然后按ctrl+a+d组合键，这样在上面另启的screen屏里启动的kibana服务就一直运行在前台了....</span></strong><br>[root@elk-node1 ~]# screen -ls<br>There is a screen on:<br>        15041.pts-0.elk-node1   (Detached)<br>1 Socket in /var/run/screen/S-root.</p>
<p><span style="background-color: #ccffff;">（3）访问kibana：http://112.110.115.10:15601/</span><br><span style="color: #0000ff;">如下，如果是添加上面设置的java日志收集信息，则在下面填写es-error*；如果是添加上面设置的系统日志信息system*，以此类型(可以从logstash界面看到日志收集项)</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111184157108-1169665374.png" alt=""></p>
<p><span style="color: #0000ff;">&nbsp;然后点击上面的Discover，在Discover中查看：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111184459999-1772130220.png" alt=""></p>
<p><span style="color: #0000ff;">查看日志登陆，需要点击“Discover”--&gt;"message",点击它后面的“add”</span><br><span style="color: #ff00ff;">注意：</span><br><span style="color: #000000; background-color: #ffcc99;">需要右边查看日志内容时带什么属性，就在左边点击相应属性后面的“add”</span><br><span style="color: #000000; background-color: #ffcc99;">如下图，添加了message和path的属性：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111184749499-1028814126.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111184809264-1464457963.png" alt=""></p>
<p>这样，右边显示的日志内容的属性就带了message和path</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111184856077-432106611.png" alt=""></p>
<p><span style="color: #0000ff;">点击右边日志内容属性后面隐藏的&lt;&lt;，就可将内容向前缩进</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185051061-1158513601.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185141327-802283511.png" alt=""></p>
<p><span style="color: #0000ff;">添加新的日志采集项，点击Settings-&gt;+Add New，比如添加system系统日志。<strong><span style="color: #ff0000;">注意后面的*不要忘了。</span></strong></span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185756530-1737275028.png" alt=""></p>
<p>&nbsp;</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185523749-1351108281.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185611420-599835704.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185635436-1408997572.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111185657045-2057786136.png" alt=""></p>
<p>&nbsp;</p>
<p><span style="color: #0000ff; background-color: #ffffff;">删除kibana里的日志采集项，如下，点击删除图标即可。</span></p>
<p><span style="background-color: #ccffff;"><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111193223217-320562680.png" alt=""></span></p>
<p>&nbsp;</p>
<p><span style="color: #0000ff;">如果打开kibana查看日志，发现没有日志内容，出现“No results found”，如下图所示，<span style="color: #ff00ff;">这说明要查看的日志在当前时间没有日志信息输出，可以点击右上角的时间钟来调试日志信息的查看。</span></span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113181014967-901403034.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113181148045-1232368202.png" alt=""></p>
<p>&nbsp;</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113181237905-351398762.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113181255295-1059340716.png" alt=""></p>
<p><span style="background-color: #ccffff;">4）收集nginx的访问日志</span></p>
<p><span style="color: #0000ff;">修改nginx的配置文件，分别在nginx.conf的http和server配置区域添加下面内容：</span></p>
<p><span style="color: #ff0000; background-color: #999999;">##### http 标签中</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; log_format  json '{"@timestamp":"$time_iso8601",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"@version":"1",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"client":"$remote_addr",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"url":"$uri",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"status":"$status",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"domain":"$host",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"host":"$server_addr",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"size":$body_bytes_sent,'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"responsetime":$request_time,'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"referer": "$http_referer",'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'"ua": "$http_user_agent"'<br>               '}';<br><span style="color: #ff0000; background-color: #999999;">##### server标签中</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; access_log  /var/log/nginx/access_json.log  json;</p>
<p>&nbsp;</p>
<p>截图如下：</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111190646749-2131221742.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111190719686-630267604.png" alt=""></p>
<p><span style="color: #0000ff;">启动nginx服务：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_247204" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# systemctl start nginx</code></div><div class="line number2 index1 alt1"><code class="cpp plain">[root@elk-node1 ~]# systemctl status nginx</code></div><div class="line number3 index2 alt2"><code class="cpp plain">● nginx.service - The nginx HTTP and reverse proxy server</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Loaded: loaded (/usr/lib/systemd/</code><code class="cpp functions bold">system</code><code class="cpp plain">/nginx.service; disabled; vendor preset: disabled)</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">Active: active (running) since Fri 2016-11-11 19:06:55 CST; 3s ago</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;</code><code class="cpp plain">Process: 15119 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;</code><code class="cpp plain">Process: 15116 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;</code><code class="cpp plain">Process: 15114 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;</code><code class="cpp plain">Main PID: 15122 (nginx)</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">CGroup: /</code><code class="cpp functions bold">system</code><code class="cpp plain">.slice/nginx.service</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">├─15122 nginx: master process /usr/sbin/nginx</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">├─15123 nginx: worker process</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">└─15124 nginx: worker process</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="cpp plain">Nov 11 19:06:54 elk-node1 systemd[1]: Starting The nginx HTTP and reverse proxy server...</code></div><div class="line number16 index15 alt1"><code class="cpp plain">Nov 11 19:06:55 elk-node1 nginx[15116]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</code></div><div class="line number17 index16 alt2"><code class="cpp plain">Nov 11 19:06:55 elk-node1 nginx[15116]: nginx: configuration file /etc/nginx/nginx.conf test is successful</code></div><div class="line number18 index17 alt1"><code class="cpp plain">Nov 11 19:06:55 elk-node1 systemd[1]: Started The nginx HTTP and reverse proxy server.</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">编写收集文件</span><br><span style="color: #0000ff;">这次使用json的方式收集：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_90807" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim json.conf </code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/nginx/access_json.log"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; </code><code class="cpp string">"json"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number7 index6 alt2"><code class="cpp plain">}</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="cpp plain">output {</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">stdout {</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; </code><code class="cpp string">"rubydebug"</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number13 index12 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">启动日志收集程序：</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f json.conf &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #008000;">#或加个&amp;放在后台执行</span></p>
<p><span style="color: #0000ff;">访问nginx页面（在elk-node1的宿主机上执行访问页面的命令：<span style="color: #ff00ff;">curl http://192.168.1.160</span>）就会出现以下内容：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_767367" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f json.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="cpp plain">Logstash startup completed</code></div><div class="line number4 index3 alt1"><code class="cpp plain">{</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@timestamp"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"2016-11-11T11:10:53.000Z"</code><code class="cpp plain">,</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@version"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"1"</code><code class="cpp plain">,</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"client"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"192.168.1.7"</code><code class="cpp plain">,</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"url"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"/index.html"</code><code class="cpp plain">,</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"status"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"200"</code><code class="cpp plain">,</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"domain"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"192.168.1.160"</code><code class="cpp plain">,</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"host"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"192.168.1.160"</code><code class="cpp plain">,</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"size"</code> <code class="cpp plain">=&gt; 3700,</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"responsetime"</code> <code class="cpp plain">=&gt; 0.0,</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"referer"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"-"</code><code class="cpp plain">,</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"ua"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2"</code><code class="cpp plain">,</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"path"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"/var/log/nginx/access_json.log"</code></div><div class="line number17 index16 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #ff00ff;">注意：</span><br><span style="color: #ff00ff;">上面的json.conf配置只是将nginx日志输出，还没有输入到elasticsearch里，所以这个时候在elasticsearch界面里是采集不到nginx日志的。</span></p>
<p><span style="color: #0000ff;">需要配置一下，将nginx日志输入到elasticsearch中，将其汇总到总文件file.conf里，如下也将nginx-log日志输入到elasticserach里：<span style="background-color: #ffff99;">（后续就可以只用这个汇总文件，把要追加的日志汇总到这个总文件里即可）</span></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_470546" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# cat file.conf </code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/messages"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/elasticsearch/huanqiu.log"</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"es-error"</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; multiline {</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pattern =&gt; </code><code class="cpp string">"^\["</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">negate =&gt; </code><code class="cpp keyword bold">true</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">what =&gt; </code><code class="cpp string">"previous"</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/nginx/access_json.log"</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; json</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"nginx-log"</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number25 index24 alt2"><code class="cpp plain">}</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="cpp plain">output {</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"system"</code><code class="cpp plain">{</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"system-%{+YYYY.MM.dd}"</code></div><div class="line number34 index33 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number35 index34 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"es-error"</code><code class="cpp plain">{</code></div><div class="line number38 index37 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number39 index38 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number40 index39 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"es-error-%{+YYYY.MM.dd}"</code></div><div class="line number41 index40 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number42 index41 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number43 index42 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"nginx-log"</code><code class="cpp plain">{</code></div><div class="line number44 index43 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number45 index44 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number46 index45 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"nignx-log-%{+YYYY.MM.dd}"</code></div><div class="line number47 index46 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number48 index47 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number49 index48 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><strong><span style="color: #ff0000;">可以加上<span style="color: #000000; background-color: #ffff99;">--configtest参数</span>，测试下配置文件是否有语法错误或配置不当的地方，这个很重要！！</span></strong><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f file.conf --configtest<br>Configuration OK</p>
<p><span style="color: #0000ff;">然后接着执行logstash命令（由于上面已经将这个执行命令放到了后台，所以这里其实不用执行，也可以先kill之前的，再放后台执行），然后可以再访问nginx界面测试下</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f file.conf &amp;</p>
<p><span style="color: #0000ff;">登陆elasticsearch界面查看：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161111202433264-1605899196.png" alt=""></p>
<p><span style="color: #0000ff;">&nbsp;将nginx日志整合到kibana界面里，如下：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113182407999-1556082679.png" alt=""></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113182739420-950066415.png" alt=""></p>
<p><span style="background-color: #ccffff;">5）收集系统日志</span></p>
<p><span style="color: #0000ff;">编写收集文件并执行。</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_50505" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# cat syslog.conf</code></div><div class="line number2 index1 alt1"><code class="csharp plain">input {</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">syslog {</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">type =&gt; </code><code class="csharp string">"system-syslog"</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">host =&gt; </code><code class="csharp string">"192.168.1.160"</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">port =&gt; </code><code class="csharp string">"514"</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number8 index7 alt1"><code class="csharp plain">}</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="csharp plain">output {</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">stdout {</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">codec =&gt; </code><code class="csharp string">"rubydebug"</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number14 index13 alt1"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">对上面的采集文件进行执行：</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f syslog.conf</p>
<p><span style="color: #0000ff;">重新开启一个窗口，查看服务是否启动：</span><br>[root@elk-node1 ~]# netstat -ntlp|grep 514<br>tcp6       0      0 192.168.1.160:514       :::*                    LISTEN      17842/java          <br>[root@elk-node1 ~]# vim /etc/rsyslog.conf<br>#*.* @@remote-host:514 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #008000;">【在此行下面添加如下内容】</span><br><span style="color: #ff0000;">*.* @@192.168.1.160:514</span></p>
<p>[root@elk-node1 ~]# systemctl  restart rsyslog</p>
<p><span style="color: #0000ff;">回到原来的窗口(即上面采集文件的执行终端)，就会出现数据：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_30414" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f syslog.conf</code></div><div class="line number2 index1 alt1"><code class="csharp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="csharp plain">Logstash startup completed</code></div><div class="line number4 index3 alt1"><code class="csharp plain">{</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"Stopping System Logging Service...\n"</code><code class="csharp plain">,</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@version"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"1"</code><code class="csharp plain">,</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@timestamp"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"2016-11-13T10:35:30.000Z"</code><code class="csharp plain">,</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"type"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"system-syslog"</code><code class="csharp plain">,</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"host"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"192.168.1.160"</code><code class="csharp plain">,</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"priority"</code> <code class="csharp plain">=&gt; 30,</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"timestamp"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"Nov 13 18:35:30"</code><code class="csharp plain">,</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"logsource"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"elk-node1"</code><code class="csharp plain">,</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"program"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"systemd"</code><code class="csharp plain">,</code></div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"severity"</code> <code class="csharp plain">=&gt; 6,</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"facility"</code> <code class="csharp plain">=&gt; 3,</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"facility_label"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"system"</code><code class="csharp plain">,</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"severity_label"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"Informational"</code></div><div class="line number18 index17 alt1"><code class="csharp plain">}</code></div><div class="line number19 index18 alt2"><code class="csharp plain">........</code></div><div class="line number20 index19 alt1"><code class="csharp plain">........</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">再次添加到总文件file.conf中:</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_78775" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# cat file.conf</code></div><div class="line number2 index1 alt1"><code class="csharp plain">input {</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">file {</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">path =&gt; </code><code class="csharp string">"/var/log/messages"</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">type =&gt; </code><code class="csharp string">"system"</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">start_position =&gt; </code><code class="csharp string">"beginning"</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">file {</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">path =&gt; </code><code class="csharp string">"/var/log/elasticsearch/huanqiu.log"</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">type =&gt; </code><code class="csharp string">"es-error"</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">start_position =&gt; </code><code class="csharp string">"beginning"</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">codec =&gt; multiline {</code></div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">pattern =&gt; </code><code class="csharp string">"^\["</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">negate =&gt; </code><code class="csharp keyword">true</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">what =&gt; </code><code class="csharp string">"previous"</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number18 index17 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number19 index18 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">file {</code></div><div class="line number20 index19 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">path =&gt; </code><code class="csharp string">"/var/log/nginx/access_json.log"</code></div><div class="line number21 index20 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">codec =&gt; json</code></div><div class="line number22 index21 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">start_position =&gt; </code><code class="csharp string">"beginning"</code></div><div class="line number23 index22 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">type =&gt; </code><code class="csharp string">"nginx-log"</code></div><div class="line number24 index23 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number25 index24 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">syslog {</code></div><div class="line number26 index25 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">type =&gt; </code><code class="csharp string">"system-syslog"</code></div><div class="line number27 index26 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">host =&gt; </code><code class="csharp string">"192.168.1.160"</code></div><div class="line number28 index27 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">port =&gt; </code><code class="csharp string">"514"</code></div><div class="line number29 index28 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number30 index29 alt1"><code class="csharp plain">}</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="csharp plain">output {</code></div><div class="line number34 index33 alt1">&nbsp;</div><div class="line number35 index34 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">[type] == </code><code class="csharp string">"system"</code><code class="csharp plain">{</code></div><div class="line number36 index35 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">elasticsearch {</code></div><div class="line number37 index36 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">hosts =&gt; [</code><code class="csharp string">"192.168.1.160:9200"</code><code class="csharp plain">]</code></div><div class="line number38 index37 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">index =&gt; </code><code class="csharp string">"system-%{+YYYY.MM.dd}"</code></div><div class="line number39 index38 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number40 index39 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">[type] == </code><code class="csharp string">"es-error"</code><code class="csharp plain">{</code></div><div class="line number43 index42 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">elasticsearch {</code></div><div class="line number44 index43 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">hosts =&gt; [</code><code class="csharp string">"192.168.1.160:9200"</code><code class="csharp plain">]</code></div><div class="line number45 index44 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">index =&gt; </code><code class="csharp string">"es-error-%{+YYYY.MM.dd}"</code></div><div class="line number46 index45 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number47 index46 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number48 index47 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">[type] == </code><code class="csharp string">"nginx-log"</code><code class="csharp plain">{</code></div><div class="line number49 index48 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">elasticsearch {</code></div><div class="line number50 index49 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">hosts =&gt; [</code><code class="csharp string">"192.168.1.160:9200"</code><code class="csharp plain">]</code></div><div class="line number51 index50 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">index =&gt; </code><code class="csharp string">"nignx-log-%{+YYYY.MM.dd}"</code></div><div class="line number52 index51 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number53 index52 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number54 index53 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">[type] == </code><code class="csharp string">"system-syslog"</code><code class="csharp plain">{</code></div><div class="line number55 index54 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">elasticsearch {</code></div><div class="line number56 index55 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">hosts =&gt; [</code><code class="csharp string">"192.168.1.160:9200"</code><code class="csharp plain">]</code></div><div class="line number57 index56 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">index =&gt; </code><code class="csharp string">"system-syslog-%{+YYYY.MM.dd}"</code></div><div class="line number58 index57 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number59 index58 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number60 index59 alt1"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行总文件(先测试下总文件配置是否有误，然后先kill之前在后台启动的file.conf文件，再次执行):</span><br>[root@elk-node1 ~]#  /opt/logstash/bin/logstash -f file.conf <span style="color: #ff00ff;">--configtest</span><br>Configuration OK<br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f file.conf &amp;</p>
<p><span style="color: #0000ff;">测试：</span><br><span style="color: #0000ff;">向日志中添加数据，看elasticsearch和kibana的变化：</span><br>[root@elk-node1 ~]# logger "hehehehehehe1"<br>[root@elk-node1 ~]# logger "hehehehehehe2"<br>[root@elk-node1 ~]# logger "hehehehehehe3"<br>[root@elk-node1 ~]# logger "hehehehehehe4"<br>[root@elk-node1 ~]# logger "hehehehehehe5"</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113185054499-940539057.png" alt=""></p>
<p><span style="color: #0000ff;">添加到kibana界面中：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113185203030-1448854931.png" alt=""></p>
<p>&nbsp;<img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161113185602295-2058479122.png" alt=""></p>
<p><span style="background-color: #ccffff;">6）TCP日志的收集</span></p>
<p><span style="color: #0000ff;">编写日志收集文件，并执行：（有需要的话，可以将下面收集文件的配置汇总到上面的总文件file.conf里，进而输入到elasticsearch界面里和kibana里查看）</span><br>[root@elk-node1 ~]# cat tcp.conf<br>input {<br>    tcp {<br>       host =&gt; "192.168.1.160"<br>       port =&gt; "6666"<br>    }<br>}<br>output {<br>    stdout {<br>       codec =&gt; "rubydebug"<br>    }<br>}</p>
<p>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f tcp.conf </p>
<p><span style="color: #0000ff;">开启另外一个窗口，测试一（安装nc命令：yum install -y nc）：</span><br>[root@elk-node1 ~]# nc 192.168.1.160 6666 &lt;/etc/resolv.conf</p>
<p><span style="color: #0000ff;">回到原来的窗口(即上面采集文件的执行终端)，就会出现数据：</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f tcp.conf <br>Settings: Default filter workers: 1<br>Logstash startup completed<br>{<br>&nbsp; &nbsp; &nbsp; &nbsp; "message" =&gt; "",<br>&nbsp; &nbsp; &nbsp; &nbsp;"@version" =&gt; "1",<br>&nbsp; &nbsp;"@timestamp" =&gt; "2016-11-13T11:01:15.280Z",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "host" =&gt; "192.168.1.160",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "port" =&gt; 49743<br>}</p>
<p><span style="color: #0000ff;">测试二：</span><br>[root@elk-node1 ~]# echo "hehe" | nc 192.168.1.160 6666<br>[root@elk-node1 ~]# echo "hehe" &gt; /dev/tcp/192.168.1.160/6666 </p>
<p><span style="color: #0000ff;">回到之前的执行端口，在去查看，就会显示出来：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_418765" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f tcp.conf </code></div><div class="line number2 index1 alt1"><code class="csharp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="csharp plain">Logstash startup completed&lt;br&gt;.......</code></div><div class="line number4 index3 alt1"><code class="csharp plain">{</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"hehe"</code><code class="csharp plain">,</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@version"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"1"</code><code class="csharp plain">,</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@timestamp"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"2016-11-13T11:39:58.263Z"</code><code class="csharp plain">,</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"host"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"192.168.1.160"</code><code class="csharp plain">,</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"port"</code> <code class="csharp plain">=&gt; 53432</code></div><div class="line number10 index9 alt1"><code class="csharp plain">}</code></div><div class="line number11 index10 alt2"><code class="csharp plain">{</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"hehe"</code><code class="csharp plain">,</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@version"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"1"</code><code class="csharp plain">,</code></div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@timestamp"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"2016-11-13T11:40:13.458Z"</code><code class="csharp plain">,</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"host"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"192.168.1.160"</code><code class="csharp plain">,</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"port"</code> <code class="csharp plain">=&gt; 53457</code></div><div class="line number17 index16 alt2"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #000000; background-color: #ccffff;">7）使用filter</span><br><span style="color: #0000ff;">编写文件：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_59357" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# cat grok.conf</code></div><div class="line number2 index1 alt1"><code class="csharp plain">input {</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">stdin{}</code></div><div class="line number4 index3 alt1"><code class="csharp plain">}</code></div><div class="line number5 index4 alt2"><code class="csharp plain">filter {</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">grok {</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; { </code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"%{IP:client} %{WORD:method} %{URIPATHPARAM:request} %{NUMBER:bytes} %{NUMBER:duration}"</code> <code class="csharp plain">}</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number9 index8 alt2"><code class="csharp plain">}</code></div><div class="line number10 index9 alt1"><code class="csharp plain">output {</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">stdout{</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">codec =&gt; </code><code class="csharp string">"rubydebug"</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number14 index13 alt1"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行检测：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_356616" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f grok.conf </code></div><div class="line number2 index1 alt1"><code class="csharp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="csharp plain">Logstash startup completed</code></div><div class="line number4 index3 alt1"><code class="csharp plain">55.3.244.1 GET /index.html 15824 0.043&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #输入这个，下面就会自动形成字典的形式</code></div><div class="line number5 index4 alt2"><code class="csharp plain">{</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"55.3.244.1 GET /index.html 15824 0.043"</code><code class="csharp plain">,</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@version"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"1"</code><code class="csharp plain">,</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"@timestamp"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"2016-11-13T11:45:47.882Z"</code><code class="csharp plain">,</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"host"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"elk-node1"</code><code class="csharp plain">,</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"client"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"55.3.244.1"</code><code class="csharp plain">,</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"method"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"GET"</code><code class="csharp plain">,</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"request"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"/index.html"</code><code class="csharp plain">,</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"bytes"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"15824"</code><code class="csharp plain">,</code></div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp string">"duration"</code> <code class="csharp plain">=&gt; </code><code class="csharp string">"0.043"</code></div><div class="line number15 index14 alt2"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">其实上面使用的那些变量在程序中都有定义：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_377340" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# cd /opt/logstash/vendor/bundle/jruby/1.9/gems/logstash-patterns-core-2.0.2/patterns/</code></div><div class="line number2 index1 alt1"><code class="csharp plain">[root@elk-node1 patterns]# ls</code></div><div class="line number3 index2 alt2"><code class="csharp plain">aws&nbsp;&nbsp;&nbsp;&nbsp; bro&nbsp;&nbsp; firewalls&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; haproxy&nbsp; junos&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mcollective&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mongodb&nbsp; postgresql&nbsp; redis</code></div><div class="line number4 index3 alt1"><code class="csharp plain">bacula&nbsp; exim&nbsp; grok-patterns&nbsp; java&nbsp;&nbsp;&nbsp;&nbsp; linux-syslog&nbsp; mcollective-patterns&nbsp; nagios&nbsp;&nbsp; rails&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ruby</code></div><div class="line number5 index4 alt2"><code class="csharp plain">[root@elk-node1 patterns]# cat grok-patterns</code></div><div class="line number6 index5 alt1"><code class="csharp plain">filter {</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp preprocessor"># drop sleep events</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">grok {</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; { </code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt;</code><code class="csharp string">"SELECT SLEEP"</code> <code class="csharp plain">}</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">add_tag =&gt; [ </code><code class="csharp string">"sleep_drop"</code> <code class="csharp plain">]</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">tag_on_failure =&gt; [] # prevent </code><code class="csharp keyword">default</code> <code class="csharp plain">_grokparsefailure tag </code><code class="csharp keyword">on</code> <code class="csharp plain">real records</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number13 index12 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp string">"sleep_drop"</code> <code class="csharp keyword">in</code> <code class="csharp plain">[tags] {</code></div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">drop {}</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">grok {</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; [ </code><code class="csharp string">"message"</code><code class="csharp plain">, </code><code class="csharp string">"(?m)^# User@Host: %{USER:user}\[[^\]]+\] @ (?:(?&lt;clienthost&gt;\S*) )?\[(?:%{IP:clientip})?\]\s+Id: %{NUMBER:row_id:int}\s*# Query_time: %{NUMBER:query_time:float}\s+Lock_time: %{NUMBER:lock_time:float}\s+Rows_sent: %{NUMBER:rows_sent:int}\s+Rows_examined: %{NUMBER:rows_examined:int}\s*(?:use %{DATA:database};\s*)?SET timestamp=%{NUMBER:timestamp};\s*(?&lt;query&gt;(?&lt;action&gt;\w+)\s+.*)\n#\s*"</code> <code class="csharp plain">]</code></div><div class="line number18 index17 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number19 index18 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">date {</code></div><div class="line number20 index19 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; [ </code><code class="csharp string">"timestamp"</code><code class="csharp plain">, </code><code class="csharp string">"UNIX"</code> <code class="csharp plain">]</code></div><div class="line number21 index20 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">remove_field =&gt; [ </code><code class="csharp string">"timestamp"</code> <code class="csharp plain">]</code></div><div class="line number22 index21 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number23 index22 alt2"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ccffff;">8）mysql慢查询</span></p>
<p><span style="color: #0000ff;">收集文件：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_363728" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp plain">[root@elk-node1 ~]# cat mysql-slow.conf</code></div><div class="line number2 index1 alt1"><code class="csharp plain">input {</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">file {</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">path =&gt; </code><code class="csharp string">"/root/slow.log"</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">type =&gt; </code><code class="csharp string">"mysql-slowlog"</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">codec =&gt; multiline {</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">pattern =&gt; </code><code class="csharp string">"^# User@Host"</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">negate =&gt; </code><code class="csharp keyword">true</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">what =&gt; </code><code class="csharp string">"previous"</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number12 index11 alt1"><code class="csharp plain">}</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="csharp plain">filter {</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp preprocessor"># drop sleep events</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">grok {</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; { </code><code class="csharp string">"message"</code> <code class="csharp plain">=&gt;</code><code class="csharp string">"SELECT SLEEP"</code> <code class="csharp plain">}</code></div><div class="line number18 index17 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">add_tag =&gt; [ </code><code class="csharp string">"sleep_drop"</code> <code class="csharp plain">]</code></div><div class="line number19 index18 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">tag_on_failure =&gt; [] # prevent </code><code class="csharp keyword">default</code> <code class="csharp plain">_grokparsefailure tag </code><code class="csharp keyword">on</code> <code class="csharp plain">real records</code></div><div class="line number20 index19 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number21 index20 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp string">"sleep_drop"</code> <code class="csharp keyword">in</code> <code class="csharp plain">[tags] {</code></div><div class="line number22 index21 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">drop {}</code></div><div class="line number23 index22 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number24 index23 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">grok {</code></div><div class="line number25 index24 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; [ </code><code class="csharp string">"message"</code><code class="csharp plain">, </code><code class="csharp string">"(?m)^# User@Host: %{USER:user}\[[^\]]+\] @ (?:(?&lt;clienthost&gt;\S*) )?\[(?:%{IP:clientip})?\]\s+Id: %{NUMBER:row_id:int}\s*# Query_time: %{NUMBER:query_time:float}\s+Lock_time: %{NUMBER:lock_time:float}\s+Rows_sent: %{NUMBER:rows_sent:int}\s+Rows_examined: %{NUMBER:rows_examined:int}\s*(?:use %{DATA:database};\s*)?SET timestamp=%{NUMBER:timestamp};\s*(?&lt;query&gt;(?&lt;action&gt;\w+)\s+.*)\n#\s*"</code> <code class="csharp plain">]</code></div><div class="line number26 index25 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number27 index26 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">date {</code></div><div class="line number28 index27 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">match =&gt; [ </code><code class="csharp string">"timestamp"</code><code class="csharp plain">, </code><code class="csharp string">"UNIX"</code> <code class="csharp plain">]</code></div><div class="line number29 index28 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">remove_field =&gt; [ </code><code class="csharp string">"timestamp"</code> <code class="csharp plain">]</code></div><div class="line number30 index29 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number31 index30 alt2"><code class="csharp plain">}</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="csharp plain">output {</code></div><div class="line number35 index34 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">stdout {</code></div><div class="line number36 index35 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">codec =&gt;</code><code class="csharp string">"rubydebug"</code></div><div class="line number37 index36 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number38 index37 alt1"><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行检测：</span><br><span style="color: #0000ff;">上面需要的/root/slow.log是自己上传的，然后自己插入数据保存后，会显示：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_221930" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f mysql-slow.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="cpp plain">Logstash startup completed</code></div><div class="line number4 index3 alt1"><code class="cpp plain">{</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@timestamp"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"2016-11-14T06:53:54.100Z"</code><code class="cpp plain">,</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"message"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"# Time: 161114 11:05:18"</code><code class="cpp plain">,</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@version"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"1"</code><code class="cpp plain">,</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"path"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"/root/slow.log"</code><code class="cpp plain">,</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"host"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"elk-node1"</code><code class="cpp plain">,</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"type"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"mysql-slowlog"</code><code class="cpp plain">,</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"tags"</code> <code class="cpp plain">=&gt; [</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">[0] </code><code class="cpp string">"_grokparsefailure"</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">]</code></div><div class="line number14 index13 alt1"><code class="cpp plain">}</code></div><div class="line number15 index14 alt2"><code class="cpp plain">{</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@timestamp"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"2016-11-14T06:53:54.105Z"</code><code class="cpp plain">,</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"message"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"# User@Host: test[test] @&nbsp; [124.65.197.154]\n# Query_time: 1.725889&nbsp; Lock_time: 0.000430 Rows_sent: 0&nbsp; Rows_examined: 0\nuse test_zh_o2o_db;\nSET timestamp=1479092718;\nSELECT trigger_name, event_manipulation, event_object_table, action_statement, action_timing, DEFINER FROM information_schema.triggers WHERE BINARY event_object_schema='test_zh_o2o_db' AND BINARY event_object_table='customer';\n# Time: 161114 12:10:30"</code><code class="cpp plain">,</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"@version"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"1"</code><code class="cpp plain">,</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"tags"</code> <code class="cpp plain">=&gt; [</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">[0] </code><code class="cpp string">"multiline"</code><code class="cpp plain">,</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">[1] </code><code class="cpp string">"_grokparsefailure"</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">],</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"path"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"/root/slow.log"</code><code class="cpp plain">,</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"host"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"elk-node1"</code><code class="cpp plain">,</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp string">"type"</code> <code class="cpp plain">=&gt; </code><code class="cpp string">"mysql-slowlog"</code></div><div class="line number26 index25 alt1"><code class="cpp plain">}</code></div><div class="line number27 index26 alt2"><code class="cpp plain">.........</code></div><div class="line number28 index27 alt1"><code class="cpp plain">.........</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ffff99; color: #0000ff;">======================================================================</span><br>接下来描述会遇见到的一个问题：<br>一旦我们的elasticsearch出现问题，就不能进行日志采集处理了！<br>这种情况下该怎么办呢？</p>
<p><span style="color: #008000;">解决方案;</span><br><span style="color: #008000;">可以在client和elasticsearch之间添加一个中间件作为缓存，先将采集到的日志内容写到中间件上，然后再从中间件输入到elasticsearch中。</span><br><span style="color: #008000;">这就完美的解决了上述的问题了。</span></p>
<p><span style="background-color: #ffcc99;">（4）ELK中使用redis作为中间件，缓存日志采集内容</span></p>
<p><span style="background-color: #ccffff;">1）redis的配置和启动</span></p>
<p>[root@elk-node1 ~]# vim /etc/redis.conf &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">#修改下面两行内容</span><br><span style="color: #ff00ff;">daemonize yes</span><br><span style="color: #ff00ff;">bind 192.168.1.160</span><br>[root@elk-node1 ~]# systemctl start redis<br>[root@elk-node1 ~]# lsof -i:6379<br>COMMAND     PID  USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME<br>redis-ser 19474 redis    4u  IPv4 1344465      0t0  TCP elk-node1:6379 (LISTEN)<br>[root@elk-node1 ~]# redis-cli -h 192.168.1.160<br>192.168.1.160:6379&gt; info<br># Server<br>redis_version:2.8.19<br>.......</p>
<p><span style="background-color: #ccffff;">2）编写从Client端收集数据的文件</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_768744" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim redis-out.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">stdin {}</code></div><div class="line number4 index3 alt1"><code class="cpp plain">}</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="cpp plain">output {</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"demo"</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number14 index13 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ccffff;">3）执行收集数据的文件，并输入数据hello redis&nbsp;</span></p>
<p>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f redis-out.conf <br>Settings: Default filter workers: 1<br>Logstash startup completed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">#下面输入数据hello redis</span><br>hello redis</p>
<p><span style="background-color: #ccffff;">4）在redis中查看数据</span></p>
<p>[root@elk-node1 ~]# redis-cli -h 192.168.1.160<br>192.168.1.160:6379&gt;<span style="color: #ff6600;"> info</span><br># Server<br>.......<br>.......<br># Keyspace<br><span style="color: #0000ff;">db6</span>:keys=1,expires=0,avg_ttl=0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #0000ff;">#在最下面一行，显示是db6</span><br>192.168.1.160:6379&gt;<span style="color: #ff6600;"> select 6</span><br>OK<br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">keys *</span><br>1) "demo"<br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">LINDEX demo -1</span><br>"{\"message\":\"hello redis\",\"@version\":\"1\",\"@timestamp\":\"2016-11-14T08:04:25.981Z\",\"host\":\"elk-node1\"}"</p>
<p><span style="background-color: #ccffff;">5）继续随便写点数据</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_463383" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# /opt/logstash/bin/logstash -f redis-out.conf </code></div><div class="line number2 index1 alt1"><code class="cpp plain">Settings: Default filter workers: 1</code></div><div class="line number3 index2 alt2"><code class="cpp plain">Logstash startup completed</code></div><div class="line number4 index3 alt1"><code class="cpp plain">hello redis</code></div><div class="line number5 index4 alt2"><code class="cpp plain">123456</code></div><div class="line number6 index5 alt1"><code class="cpp plain">asdf</code></div><div class="line number7 index6 alt2"><code class="cpp plain">ert</code></div><div class="line number8 index7 alt1"><code class="cpp plain">wang</code></div><div class="line number9 index8 alt2"><code class="cpp plain">shi</code></div><div class="line number10 index9 alt1"><code class="cpp plain">bo</code></div><div class="line number11 index10 alt2"><code class="cpp plain">guohuihui</code></div><div class="line number12 index11 alt1"><code class="cpp plain">as</code></div><div class="line number13 index12 alt2"><code class="cpp plain">we</code></div><div class="line number14 index13 alt1"><code class="cpp plain">r</code></div><div class="line number15 index14 alt2"><code class="cpp plain">g</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="cpp plain">asdfjkdfsak</code></div><div class="line number18 index17 alt1"><code class="cpp plain">5423wer</code></div><div class="line number19 index18 alt2"><code class="cpp plain">34rt3</code></div><div class="line number20 index19 alt1"><code class="cpp plain">6y</code></div><div class="line number21 index20 alt2"><code class="cpp plain">7uj</code></div><div class="line number22 index21 alt1"><code class="cpp plain">u</code></div><div class="line number23 index22 alt2"><code class="cpp plain">io9</code></div><div class="line number24 index23 alt1"><code class="cpp plain">sdjfhsdk890</code></div><div class="line number25 index24 alt2"><code class="cpp plain">huanqiu</code></div><div class="line number26 index25 alt1"><code class="cpp plain">huanqiuchain</code></div><div class="line number27 index26 alt2"><code class="cpp plain">hqsb</code></div><div class="line number28 index27 alt1"><code class="cpp plain">asda&nbsp;&nbsp;&nbsp; </code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="background-color: #ccffff;">6）在redis中查看</span></p>
<p><span style="color: #0000ff;">在redis中查看长度：</span><br>[root@elk-node1 ~]# redis-cli -h 192.168.1.160<br>192.168.1.160:6379&gt; <span style="color: #ff6600;">info</span><br># Server<br>redis_version:2.8.19<br>.......<br>.......<br># Keyspace<br><span style="color: #0000ff;">db6</span>:keys=1,expires=0,avg_ttl=0 &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">#显示是db6</span><br>192.168.1.160:6379&gt; <span style="color: #ff6600;">select 6</span><br>OK<br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">keys *</span><br>1) "<span style="color: #0000ff;">demo</span>"<br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">LLEN demo</span><br>(integer) 24</p>
<p><span style="color: #000000; background-color: #ccffff;"><strong>7）将redis中的内容写到ES中</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_749614" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim redis-in.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input { </code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"demo"</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number10 index9 alt1"><code class="cpp plain">}</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="cpp plain">output {</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"redis-in-%{+YYYY.MM.dd}"</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number17 index16 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行：</span><br>[root@elk-node1 ~]#  /opt/logstash/bin/logstash -f  redis-in.conf --configtest<br>Configuration OK<br>[root@elk-node1 ~]#  /opt/logstash/bin/logstash -f  redis-in.conf &amp;</p>
<p><span style="color: #0000ff;">在redis中查看，发现数据已被读出：</span><br>192.168.1.160:6379[6]&gt; LLEN demo<br>(integer) 0</p>
<p><span style="color: #0000ff; background-color: #ffff99;">=============================<strong><span style="color: #ff0000;">温馨提示</span></strong>===========================</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_43942" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">redis默认只有16个数据库, 也就是说最多只能有16个db, 即db01-db15</code></div><div class="line number2 index1 alt1"><code class="bash plain">但是key值可以设置不同, 也就是针对不同日志的key前缀可以设置不同.</code></div><div class="line number3 index2 alt2"><code class="bash plain">比如: </code></div><div class="line number4 index3 alt1"><code class="bash plain">key =&gt; </code><code class="bash string">"nginx.log"</code><code class="bash plain">的值最多可以设置16个db, 即db01-db15</code></div><div class="line number5 index4 alt2"><code class="bash plain">key =&gt; </code><code class="bash string">"mysql.log"</code><code class="bash plain">的值最多可以设置16个db, 即db01-db15</code></div><div class="line number6 index5 alt1"><code class="bash plain">key =&gt; </code><code class="bash string">"tomcat.log"</code><code class="bash plain">的值最多可以设置16个db, 即db01-db15</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">登陆elasticsearch界面查看：</span></p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161114163816951-2033136431.png" alt=""></p>
<p>&nbsp;</p>
<p><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/907596-20161114163851638-439400114.png" alt=""></p>
<p><span style="background-color: #ccffff;"><strong>8）接着，将收集到的所有日志写入到redis中。这了重新定义一个添加redis缓存后的总文件shipper.conf。（可以将之前执行的总文件file.conf停掉）</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_551098" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node1 ~]# vim shipper.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/messages"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/elasticsearch/huanqiu.log"</code></div><div class="line number11 index10 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"es-error"</code></div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; multiline {</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">pattern =&gt; </code><code class="cpp string">"^\["</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">negate =&gt; </code><code class="cpp keyword bold">true</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">what =&gt; </code><code class="cpp string">"previous"</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">file {</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">path =&gt; </code><code class="cpp string">"/var/log/nginx/access_json.log"</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">codec =&gt; json</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">start_position =&gt; </code><code class="cpp string">"beginning"</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"nginx-log"</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">syslog {</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system-syslog"</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"514"</code></div><div class="line number29 index28 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;</code>&nbsp;</div><div class="line number31 index30 alt2"><code class="cpp plain">}</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;</code>&nbsp;</div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;</code>&nbsp;</div><div class="line number34 index33 alt1"><code class="cpp plain">output {</code></div><div class="line number35 index34 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"system"</code><code class="cpp plain">{</code></div><div class="line number36 index35 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number37 index36 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number38 index37 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number39 index38 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number40 index39 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number41 index40 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"system"</code></div><div class="line number42 index41 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number43 index42 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number44 index43 alt1"><code class="cpp spaces">&nbsp;</code>&nbsp;</div><div class="line number45 index44 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"es-error"</code><code class="cpp plain">{</code></div><div class="line number46 index45 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number47 index46 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number48 index47 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number49 index48 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number50 index49 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number51 index50 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"demo"</code></div><div class="line number52 index51 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number53 index52 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number54 index53 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"nginx-log"</code><code class="cpp plain">{&nbsp;&nbsp;&nbsp; </code></div><div class="line number55 index54 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number56 index55 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number57 index56 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number58 index57 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number59 index58 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number60 index59 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"nginx-log"</code></div><div class="line number61 index60 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number62 index61 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number63 index62 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"system-syslog"</code><code class="cpp plain">{</code></div><div class="line number64 index63 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number65 index64 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number66 index65 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number67 index66 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number68 index67 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number69 index68 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"system-syslog"</code></div><div class="line number70 index69 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}&nbsp;&nbsp;&nbsp; </code></div><div class="line number71 index70 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number72 index71 alt1"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行上面的文件（提前将上面之前启动的file.conf文件的执行给结束掉！）</span><br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f shipper.conf --configtest<br>Configuration OK<br>[root@elk-node1 ~]# /opt/logstash/bin/logstash -f shipper.conf<br>Settings: Default filter workers: 1<br>Logstash startup completed</p>
<p><span style="color: #0000ff;">在redis中查看：</span><br>[root@elk-node1 ~]# redis-cli -h 192.168.1.160<br>192.168.1.160:6379&gt; <span style="color: #ff6600;">info</span><br># Server<br>redis_version:2.8.19<br>.......<br>.......<br># Keyspace<br><span style="color: #0000ff;">db6</span>:keys=1,expires=0,avg_ttl=0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="color: #0000ff;">#显示是db6</span><br>192.168.1.160:6379&gt; <span style="color: #ff6600;">select 6</span><br>OK<br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">keys *</span><br>1) "demo"<br>2) "system"<br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">keys *</span><br>1) "nginx-log"<br>2) "demo"<br>3) "system"</p>
<p><span style="color: #0000ff;">另开一个窗口，添加点日志:</span><br>[root@elk-node1 ~]# logger "12325423"<br>[root@elk-node1 ~]# logger "12325423"<br>[root@elk-node1 ~]# logger "12325423"<br>[root@elk-node1 ~]# logger "12325423"<br>[root@elk-node1 ~]# logger "12325423"<br>[root@elk-node1 ~]# logger "12325423"</p>
<p><span style="color: #0000ff;">又会增加日志：</span><br>192.168.1.160:6379[6]&gt; <span style="color: #ff6600;">keys *</span><br>1) "system-syslog"<br>2) "nginx-log"<br>3) "demo"<br>4) "system"</p>
<p><span style="color: #ff0000;">其实可以在任意的一台ES中将数据从redis读取到ES中。</span><br><span style="color: #008000;"><strong><span style="background-color: #ffff99;">下面咱们在elk-node2节点，将数据从redis读取到ES中：</span></strong></span></p>
<p><span style="color: #0000ff;">编写文件：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_691613" class="syntaxhighlighter  cpp"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="cpp plain">[root@elk-node2 ~]# cat file.conf</code></div><div class="line number2 index1 alt1"><code class="cpp plain">input {</code></div><div class="line number3 index2 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number4 index3 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system"</code></div><div class="line number5 index4 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number6 index5 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number7 index6 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number8 index7 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number9 index8 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"system"</code></div><div class="line number10 index9 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number13 index12 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"es-error"</code></div><div class="line number14 index13 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number15 index14 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number16 index15 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number17 index16 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number18 index17 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"es-error"</code></div><div class="line number19 index18 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number20 index19 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number21 index20 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"nginx-log"</code></div><div class="line number22 index21 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number23 index22 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number24 index23 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number25 index24 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number26 index25 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"nginx-log"</code></div><div class="line number27 index26 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number28 index27 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">redis {</code></div><div class="line number29 index28 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">type =&gt; </code><code class="cpp string">"system-syslog"</code></div><div class="line number30 index29 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">host =&gt; </code><code class="cpp string">"192.168.1.160"</code></div><div class="line number31 index30 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">port =&gt; </code><code class="cpp string">"6379"</code></div><div class="line number32 index31 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">db =&gt; </code><code class="cpp string">"6"</code></div><div class="line number33 index32 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">data_type =&gt; </code><code class="cpp string">"list"</code></div><div class="line number34 index33 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">key =&gt; </code><code class="cpp string">"system-syslog"</code></div><div class="line number35 index34 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}&nbsp;&nbsp;&nbsp; </code></div><div class="line number36 index35 alt1">&nbsp;</div><div class="line number37 index36 alt2"><code class="cpp plain">}</code></div><div class="line number38 index37 alt1">&nbsp;</div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="cpp plain">output {</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"system"</code><code class="cpp plain">{</code></div><div class="line number43 index42 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number44 index43 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number45 index44 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"system-%{+YYYY.MM.dd}"</code></div><div class="line number46 index45 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number47 index46 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number48 index47 alt1">&nbsp;</div><div class="line number49 index48 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"es-error"</code><code class="cpp plain">{</code></div><div class="line number50 index49 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number51 index50 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number52 index51 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"es-error-%{+YYYY.MM.dd}"</code></div><div class="line number53 index52 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number54 index53 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number55 index54 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"nginx-log"</code><code class="cpp plain">{</code></div><div class="line number56 index55 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number57 index56 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number58 index57 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"nignx-log-%{+YYYY.MM.dd}"</code></div><div class="line number59 index58 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number60 index59 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number61 index60 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp keyword bold">if</code> <code class="cpp plain">[type] == </code><code class="cpp string">"system-syslog"</code><code class="cpp plain">{</code></div><div class="line number62 index61 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">elasticsearch {</code></div><div class="line number63 index62 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">hosts =&gt; [</code><code class="cpp string">"192.168.1.160:9200"</code><code class="cpp plain">]</code></div><div class="line number64 index63 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">index =&gt; </code><code class="cpp string">"system-syslog-%{+YYYY.MM.dd}"</code></div><div class="line number65 index64 alt2"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number66 index65 alt1"><code class="cpp spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="cpp plain">}</code></div><div class="line number67 index66 alt2"><code class="cpp plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #0000ff;">执行：</span><br>[root@elk-node2 ~]# /opt/logstash/bin/logstash -f file.conf --configtest<br>Configuration OK<br>[root@elk-node2 ~]# /opt/logstash/bin/logstash -f file.conf &amp;</p>
<p><span style="color: #0000ff;">去redis中检查，发现数据已经被读出到elasticsearch中了。</span><br>192.168.1.160:6379[6]&gt; keys *<br>(empty list or set)</p>
<p><span style="color: #0000ff;">同时登陆logstash和kibana看，发现可以正常收集到日志了</span>。</p>
<p><span style="color: #0000ff;">可以执行这个 去查看nginx日志</span> <br>[root@elk-node1 ~]# ab -n10000 -c1 http://192.168.1.160/</p>
<p><span style="color: #0000ff;">也可以启动多个redis写到ES中，具体根据自己的实际情况而定。</span></p>
<p><strong><span style="color: #ff9900;">==============logstash配置java环境===============</span></strong><br>由于新版的ELK环境要求java1.8，但是有些服务器由于业务代码自身限制只能用java6或java7。<br>这种情况下，要安装Logstash，就只能单独配置Logstas自己使用的java环境了。</p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_52274" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">操作如下：</code></div><div class="line number2 index1 alt1"><code class="bash plain">0) 使用rpm包安装logstash</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="bash plain">1）安装java8，参考：http:</code><code class="bash plain">//www</code><code class="bash plain">.cnblogs.com</code><code class="bash plain">/kevingrace/p/7607442</code><code class="bash plain">.html</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="bash plain">2）在</code><code class="bash plain">/etc/sysconfig/logstash</code><code class="bash plain">文件结尾添加下面两行内容：</code></div><div class="line number7 index6 alt2"><code class="bash plain">[root@cx-app01 ~]</code><code class="bash comments"># vim /etc/sysconfig/logstash</code></div><div class="line number8 index7 alt1"><code class="bash plain">.......</code></div><div class="line number9 index8 alt2"><code class="bash plain">JAVA_CMD=</code><code class="bash plain">/usr/local/jdk1</code><code class="bash plain">.8.0_172</code><code class="bash plain">/bin</code></div><div class="line number10 index9 alt1"><code class="bash plain">JAVA_HOME=</code><code class="bash plain">/usr/local/jdk1</code><code class="bash plain">.8.0_172</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="bash plain">3）在</code><code class="bash plain">/opt/logstash/bin/logstash</code><code class="bash plain">.lib.sh文件添加下面一行内容：</code></div><div class="line number13 index12 alt2"><code class="bash plain">[root@cx-app02 ~]</code><code class="bash comments"># vim /opt/logstash/bin/logstash.lib.sh</code></div><div class="line number14 index13 alt1"><code class="bash plain">.......</code></div><div class="line number15 index14 alt2"><code class="bash functions">export</code> <code class="bash plain">JAVA_HOME=</code><code class="bash plain">/usr/local/jdk1</code><code class="bash plain">.8.0_172</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="bash plain">4) 然后使用logstash收集日志，就不会报java环境错误了。</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #ff9900;"><strong>==================配置范例===================</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_28916" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div><div class="line number108 index107 alt1">108</div><div class="line number109 index108 alt2">109</div><div class="line number110 index109 alt1">110</div><div class="line number111 index110 alt2">111</div><div class="line number112 index111 alt1">112</div><div class="line number113 index112 alt2">113</div><div class="line number114 index113 alt1">114</div><div class="line number115 index114 alt2">115</div><div class="line number116 index115 alt1">116</div><div class="line number117 index116 alt2">117</div><div class="line number118 index117 alt1">118</div><div class="line number119 index118 alt2">119</div><div class="line number120 index119 alt1">120</div><div class="line number121 index120 alt2">121</div><div class="line number122 index121 alt1">122</div><div class="line number123 index122 alt2">123</div><div class="line number124 index123 alt1">124</div><div class="line number125 index124 alt2">125</div><div class="line number126 index125 alt1">126</div><div class="line number127 index126 alt2">127</div><div class="line number128 index127 alt1">128</div><div class="line number129 index128 alt2">129</div><div class="line number130 index129 alt1">130</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">如下的配置范例：</code></div><div class="line number2 index1 alt1"><code class="bash plain">192.168.10.44为elk的master节点，同时也是redis节点</code></div><div class="line number3 index2 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number4 index3 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># pwd</code></div><div class="line number5 index4 alt2"><code class="bash plain">/opt</code></div><div class="line number6 index5 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># cat redis-in.conf</code></div><div class="line number7 index6 alt2"><code class="bash plain">input {</code></div><div class="line number8 index7 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">file</code> <code class="bash plain">{</code></div><div class="line number9 index8 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">path =&gt; </code><code class="bash string">"/usr/local/tomcat8/logs/catalina.out"</code></div><div class="line number10 index9 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">type</code> <code class="bash plain">=&gt; </code><code class="bash string">"tomcat8-logs"</code></div><div class="line number11 index10 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">start_position =&gt; </code><code class="bash string">"beginning"</code></div><div class="line number12 index11 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">codec =&gt; multiline {</code></div><div class="line number13 index12 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">pattern =&gt; </code><code class="bash string">"^\["</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="bash plain">//</code><code class="bash plain">表示收集以</code><code class="bash string">"["</code><code class="bash plain">开头的日志信息</code></div><div class="line number14 index13 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">negate =&gt; </code><code class="bash functions">true</code></div><div class="line number15 index14 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">what =&gt; </code><code class="bash string">"previous"</code></div><div class="line number16 index15 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number17 index16 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number18 index17 alt1"><code class="bash plain">}</code></div><div class="line number19 index18 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number20 index19 alt1"><code class="bash plain">output {</code></div><div class="line number21 index20 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">[</code><code class="bash functions">type</code><code class="bash plain">] == </code><code class="bash string">"tomcat8-logs"</code><code class="bash plain">{</code></div><div class="line number22 index21 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">redis {</code></div><div class="line number23 index22 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">host =&gt; </code><code class="bash string">"192.168.10.44"</code></div><div class="line number24 index23 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">port =&gt; </code><code class="bash string">"6379"</code></div><div class="line number25 index24 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">db =&gt; </code><code class="bash string">"1"</code></div><div class="line number26 index25 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">data_type =&gt; </code><code class="bash string">"list"</code></div><div class="line number27 index26 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">key =&gt; </code><code class="bash string">"tomcat8-logs"</code></div><div class="line number28 index27 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">} </code></div><div class="line number29 index28 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number30 index29 alt1"><code class="bash plain">}</code></div><div class="line number31 index30 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number32 index31 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># cat redis-input.conf</code></div><div class="line number33 index32 alt2"><code class="bash plain">input {</code></div><div class="line number34 index33 alt1"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash functions">file</code> <code class="bash plain">{</code></div><div class="line number35 index34 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">path =&gt; </code><code class="bash string">"/var/log/messages"</code></div><div class="line number36 index35 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">type</code> <code class="bash plain">=&gt; </code><code class="bash string">"systemlog"</code></div><div class="line number37 index36 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">start_position =&gt; </code><code class="bash string">"beginning"</code></div><div class="line number38 index37 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">stat_interval =&gt; </code><code class="bash string">"2"</code></div><div class="line number39 index38 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number40 index39 alt1"><code class="bash plain">}</code></div><div class="line number41 index40 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number42 index41 alt1"><code class="bash plain">output {</code></div><div class="line number43 index42 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">[</code><code class="bash functions">type</code><code class="bash plain">] == </code><code class="bash string">"systemlog"</code> <code class="bash plain">{</code></div><div class="line number44 index43 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">redis {</code></div><div class="line number45 index44 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">data_type =&gt; </code><code class="bash string">"list"</code></div><div class="line number46 index45 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">host =&gt; </code><code class="bash string">"192.168.10.44"</code></div><div class="line number47 index46 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">db =&gt; </code><code class="bash string">"2"</code></div><div class="line number48 index47 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">port =&gt; </code><code class="bash string">"6379"</code></div><div class="line number49 index48 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">key =&gt; </code><code class="bash string">"systemlog"</code></div><div class="line number50 index49 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number51 index50 alt2"><code class="bash spaces">&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number52 index51 alt1"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number53 index52 alt2"><code class="bash plain">}</code></div><div class="line number54 index53 alt1"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number55 index54 alt2"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># cat file.conf</code></div><div class="line number56 index55 alt1"><code class="bash plain">input {</code></div><div class="line number57 index56 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">redis {</code></div><div class="line number58 index57 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">type</code> <code class="bash plain">=&gt; </code><code class="bash string">"tomcat8-logs"</code></div><div class="line number59 index58 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">host =&gt; </code><code class="bash string">"192.168.10.44"</code></div><div class="line number60 index59 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">port =&gt; </code><code class="bash string">"6379"</code></div><div class="line number61 index60 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">db =&gt; </code><code class="bash string">"1"</code></div><div class="line number62 index61 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">data_type =&gt; </code><code class="bash string">"list"</code></div><div class="line number63 index62 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">key =&gt; </code><code class="bash string">"tomcat8-logs"</code></div><div class="line number64 index63 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number65 index64 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number66 index65 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">redis {</code></div><div class="line number67 index66 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash functions">type</code> <code class="bash plain">=&gt; </code><code class="bash string">"systemlog"</code></div><div class="line number68 index67 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">host =&gt; </code><code class="bash string">"192.168.10.44"</code></div><div class="line number69 index68 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">port =&gt; </code><code class="bash string">"6379"</code></div><div class="line number70 index69 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">db =&gt; </code><code class="bash string">"2"</code></div><div class="line number71 index70 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">data_type =&gt; </code><code class="bash string">"list"</code></div><div class="line number72 index71 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">key =&gt; </code><code class="bash string">"systemlog"</code></div><div class="line number73 index72 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">} </code></div><div class="line number74 index73 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number75 index74 alt2"><code class="bash plain">}</code></div><div class="line number76 index75 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number77 index76 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number78 index77 alt1"><code class="bash plain">output {</code></div><div class="line number79 index78 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number80 index79 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">[</code><code class="bash functions">type</code><code class="bash plain">] == </code><code class="bash string">"tomcat8-logs"</code><code class="bash plain">{</code></div><div class="line number81 index80 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">elasticsearch {</code></div><div class="line number82 index81 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">hosts =&gt; [</code><code class="bash string">"192.168.10.44:9200"</code><code class="bash plain">]</code></div><div class="line number83 index82 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">index =&gt; </code><code class="bash string">"elk-node2-tomcat8-logs-%{+YYYY.MM.dd}"</code></div><div class="line number84 index83 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number85 index84 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number86 index85 alt1"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number87 index86 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash keyword">if</code> <code class="bash plain">[</code><code class="bash functions">type</code><code class="bash plain">] == </code><code class="bash string">"systemlog"</code><code class="bash plain">{</code></div><div class="line number88 index87 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">elasticsearch {</code></div><div class="line number89 index88 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">hosts =&gt; [</code><code class="bash string">"192.168.10.44:9200"</code><code class="bash plain">]</code></div><div class="line number90 index89 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">index =&gt; </code><code class="bash string">"elk-node2-systemlog-%{+YYYY.MM.dd}"</code></div><div class="line number91 index90 alt2"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number92 index91 alt1"><code class="bash spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="bash plain">}</code></div><div class="line number93 index92 alt2"><code class="bash plain">}</code></div><div class="line number94 index93 alt1"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number95 index94 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number96 index95 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># /opt/logstash/bin/logstash -f /opt/redis-in.conf --configtest</code></div><div class="line number97 index96 alt2"><code class="bash plain">Configuration OK</code></div><div class="line number98 index97 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># /opt/logstash/bin/logstash -f /opt/redis-input.conf --configtest</code></div><div class="line number99 index98 alt2"><code class="bash plain">Configuration OK</code></div><div class="line number100 index99 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># /opt/logstash/bin/logstash -f /opt/file.conf --configtest</code></div><div class="line number101 index100 alt2"><code class="bash plain">Configuration OK</code></div><div class="line number102 index101 alt1"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number103 index102 alt2"><code class="bash plain">启动logstash</code></div><div class="line number104 index103 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># /opt/logstash/bin/logstash -f /opt/redis-in.conf &amp;</code></div><div class="line number105 index104 alt2"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># /opt/logstash/bin/logstash -f /opt/redis-input.conf &amp;</code></div><div class="line number106 index105 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># /opt/logstash/bin/logstash -f /opt/file.conf &amp;</code></div><div class="line number107 index106 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number108 index107 alt1"><code class="bash plain">这时候，当</code><code class="bash plain">/usr/local/tomcat8/logs/catalina</code><code class="bash plain">.out和</code><code class="bash plain">/var/log/messages</code><code class="bash plain">文件里有新日志信息写入时，就会触发动作，</code></div><div class="line number109 index108 alt2"><code class="bash plain">在redis里就能查看到相关信息，并查看写入到es里。</code></div><div class="line number110 index109 alt1">&nbsp;</div><div class="line number111 index110 alt2"><code class="bash plain">=========================================================================================================</code></div><div class="line number112 index111 alt1"><code class="bash plain">温馨提示：</code></div><div class="line number113 index112 alt2"><code class="bash plain">当客户机的日志信息收集后，经过redis刚读到es数据库里后，如果没有新数据写入，则默认在es的访问界面里是看不到</code></div><div class="line number114 index113 alt1"><code class="bash plain">数据的，只有当日志文件里有新的日志写入后才会触发数据展示的动作，即es的访问界面（http:</code><code class="bash plain">//192</code><code class="bash plain">.168.10.44:9200</code><code class="bash plain">/_plugin/head/</code><code class="bash plain">）</code></div><div class="line number115 index114 alt2"><code class="bash plain">里才能看到日志数据的展示效果。</code></div><div class="line number116 index115 alt1"><code class="bash plain">==========================================================================================================</code></div><div class="line number117 index116 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number118 index117 alt1"><code class="bash plain">假设想上面两个文件里写入测试数据</code></div><div class="line number119 index118 alt2"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># echo "hellohellohellohello" &gt;&gt; /var/log/messages</code></div><div class="line number120 index119 alt1"><code class="bash plain">[root@client-node01 opt]</code><code class="bash comments"># echo "[hahahahahahhahahahahahahahahahahahah]" &gt;&gt; /usr/local/tomcat8/logs/catalina.out</code></div><div class="line number121 index120 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number122 index121 alt1"><code class="bash plain">到redis里发现有相关的key，很快就会读到es里。可以配置到kibana里观察。</code></div><div class="line number123 index122 alt2"><code class="bash spaces">&nbsp;&nbsp;</code>&nbsp;</div><div class="line number124 index123 alt1"><code class="bash plain">可以先测试下日志信息是否写到redis里？然后再测试下数据是否从redis读到es里？一步步确定数据去向。</code></div><div class="line number125 index124 alt2"><code class="bash spaces">&nbsp;</code>&nbsp;</div><div class="line number126 index125 alt1"><code class="bash plain">注意上面redis-</code><code class="bash keyword">in</code><code class="bash plain">.conf文件中的下面设置，使用正则匹配，收集以哪些字符开头的日志信息：</code></div><div class="line number127 index126 alt2"><code class="bash plain">pattern =&gt; </code><code class="bash string">"^\["</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="bash plain">表示收集以</code><code class="bash string">"["</code><code class="bash plain">开头的日志信息</code></div><div class="line number128 index127 alt1"><code class="bash plain">pattern =&gt; </code><code class="bash string">"^2018"</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="bash plain">表示收集以</code><code class="bash string">"2018"</code><code class="bash plain">开头的日志信息</code></div><div class="line number129 index128 alt2"><code class="bash plain">pattern =&gt; </code><code class="bash string">"^[a-zA-Z0-9]"</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <code class="bash plain">表示收集以字母（大小写）或数字开头的日志信息</code></div><div class="line number130 index129 alt1"><code class="bash plain">pattern =&gt; </code><code class="bash string">"^[a-zA-Z0-9]|[^ ]+"</code>&nbsp;&nbsp;&nbsp;&nbsp; <code class="bash plain">表示收集以字母（大小写）或数字或空格的日志信息</code></div></div></td></tr></tbody></table></div></div>
</div></div><div id="MySignature" style="display: block;">***************当你发现自己的才华撑不起野心时，就请安静下来学习吧***************</div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="https://www.cnblogs.com/kevingrace/category/888028.html" target="_blank">日志分析</a></div>
<div id="EntryTag"></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(5919021,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;2423edd6-4be4-e511-9fc1-ac853d9f53cc&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/kevingrace/" target="_blank"><img src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/20161124180837.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/kevingrace/">散尽浮华</a><br>
            <a href="https://home.cnblogs.com/u/kevingrace/followees">关注 - 23</a><br>
            <a href="https://home.cnblogs.com/u/kevingrace/followers">粉丝 - 1998</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;2423edd6-4be4-e511-9fc1-ac853d9f53cc&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(5919021,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">29</span>
    </div>
    <div class="buryit" onclick="votePost(5919021,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
<script type="text/javascript">
    currentDiggType = 0;
</script></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="https://www.cnblogs.com/kevingrace/p/5909719.html" class="p_n_p_prefix">« </a> 上一篇：<a href="https://www.cnblogs.com/kevingrace/p/5909719.html" title="发布于2016-09-26 16:41">网络知识梳理--OSI七层网络与TCP/IP五层网络架构及二层/三层网络</a><br><a href="https://www.cnblogs.com/kevingrace/p/5922920.html" class="p_n_p_prefix">» </a> 下一篇：<a href="https://www.cnblogs.com/kevingrace/p/5922920.html" title="发布于2016-09-30 10:20">kvm虚拟化管理平台WebVirtMgr部署-完整记录（安装Windows虚拟机）-(4)</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2016-09-29 10:41</span> <a href="https://www.cnblogs.com/kevingrace/">散尽浮华</a> 阅读(<span id="post_view_count">159520</span>) 评论(<span id="post_comment_count">24</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=5919021" rel="nofollow">编辑</a> <a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" onclick="AddToWz(5919021);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=271300,cb_entryId=5919021,cb_blogApp=currentBlogApp,cb_blogUserGuid='2423edd6-4be4-e511-9fc1-ac853d9f53cc',cb_entryCreatedDate='2016/9/29 10:41:00';loadViewCount(cb_entryId);var cb_postType=1;var isMarkdown=false;</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<!--done-->
<br>
<div class="feedback_area_title">评论</div>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3577186" class="layer">#1楼</a><a name="3577186" id="comment_anchor_3577186"></a> <span class="comment_date">2016-12-10 10:15</span> | <a id="a_comment_author_3577186" href="http://home.cnblogs.com/u/984089/" target="_blank">lanyanfeng</a> <a href="http://msg.cnblogs.com/send/lanyanfeng" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3577186" class="blog_comment_body">非常详细，有没有对windows IIS日志做索引啊</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3577186,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3577186,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3577719" class="layer">#2楼</a><a name="3577719" id="comment_anchor_3577719"></a>[<span class="louzhu">楼主</span>] <span class="comment_date">2016-12-11 11:48</span> | <a id="a_comment_author_3577719" href="https://www.cnblogs.com/kevingrace/" target="_blank">散尽浮华</a> <a href="http://msg.cnblogs.com/send/%E6%95%A3%E5%B0%BD%E6%B5%AE%E5%8D%8E" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3577719" class="blog_comment_body"><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3577186" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3577186);">@</a>
lanyanfeng<br>暂时还没有</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3577719,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3577719,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3577719_avatar" style="display:none;">http://pic.cnblogs.com/face/907596/20161124180837.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3654310" class="layer">#3楼</a><a name="3654310" id="comment_anchor_3654310"></a> <span class="comment_date">2017-03-29 10:06</span> | <a id="a_comment_author_3654310" href="http://home.cnblogs.com/u/677031/" target="_blank">zhouxinwolf</a> <a href="http://msg.cnblogs.com/send/zhouxinwolf" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3654310" class="blog_comment_body">真的很详细，可惜我也是想要windows下使用elk的例子，初次接触，自己参考了好多例子，好多问题，醉了~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3654310,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3654310,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3711048" class="layer">#4楼</a><a name="3711048" id="comment_anchor_3711048"></a> <span class="comment_date">2017-06-09 17:01</span> | <a id="a_comment_author_3711048" href="http://home.cnblogs.com/u/1180192/" target="_blank">C聪</a> <a href="http://msg.cnblogs.com/send/C%E8%81%AA" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3711048" class="blog_comment_body">大神你好，请问从elasticsearch读出来的系统日志如access_log怎么进行排序呢？现在默认是根据评分进行排序，而且不能更改。而系统日志是希望可以根据时间进行倒序排序的，类似tail -f</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3711048,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3711048,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3770932" class="layer">#5楼</a><a name="3770932" id="comment_anchor_3770932"></a> <span class="comment_date">2017-08-30 18:36</span> | <a id="a_comment_author_3770932" href="https://www.cnblogs.com/Jeamine/" target="_blank">Jeamine</a> <a href="http://msg.cnblogs.com/send/Jeamine" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3770932" class="blog_comment_body">大神 能不能监控sql serve的日志，或者能不能给点 指导</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3770932,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3770932,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3770932_avatar" style="display:none;">http://pic.cnblogs.com/face/703138/20141217145516.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3798068" class="layer">#6楼</a><a name="3798068" id="comment_anchor_3798068"></a> <span class="comment_date">2017-09-27 10:31</span> | <a id="a_comment_author_3798068" href="https://www.cnblogs.com/91king/" target="_blank">91King</a> <a href="http://msg.cnblogs.com/send/91King" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3798068" class="blog_comment_body">你好 大牛，你写的文章非常详细，我是运维工程师 ，我想加你联系方式可以么？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3798068,&#39;Digg&#39;,this)">支持(7)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3798068,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3798068_avatar" style="display:none;">http://pic.cnblogs.com/face/1031862/20160923162453.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3828961" class="layer">#7楼</a><a name="3828961" id="comment_anchor_3828961"></a> <span class="comment_date">2017-11-02 15:15</span> | <a id="a_comment_author_3828961" href="https://www.cnblogs.com/stefan-liao/" target="_blank">Stefan_Liao</a> <a href="http://msg.cnblogs.com/send/Stefan_Liao" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3828961" class="blog_comment_body">很详细，mark</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3828961,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3828961,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3828961_avatar" style="display:none;">http://pic.cnblogs.com/face/422481/20150407191507.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3903230" class="layer">#8楼</a><a name="3903230" id="comment_anchor_3903230"></a> <span class="comment_date">2018-02-03 14:47</span> | <a id="a_comment_author_3903230" href="https://www.cnblogs.com/sunhongleibibi/" target="_blank">孙红雷哔哔</a> <a href="http://msg.cnblogs.com/send/%E5%AD%99%E7%BA%A2%E9%9B%B7%E5%93%94%E5%93%94" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3903230" class="blog_comment_body">学习了，向大神致敬</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3903230,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3903230,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3903230_avatar" style="display:none;">http://pic.cnblogs.com/face/1274684/20171107235410.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3956877" class="layer">#9楼</a><a name="3956877" id="comment_anchor_3956877"></a> <span class="comment_date">2018-04-20 17:56</span> | <a id="a_comment_author_3956877" href="https://www.cnblogs.com/zxlinux/" target="_blank">梦幻5开</a> <a href="http://msg.cnblogs.com/send/%E6%A2%A6%E5%B9%BB5%E5%BC%80" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3956877" class="blog_comment_body">好长</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3956877,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3956877,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3956877_avatar" style="display:none;">http://pic.cnblogs.com/face/1273824/20171106221931.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#3995730" class="layer">#10楼</a><a name="3995730" id="comment_anchor_3995730"></a> <span class="comment_date">2018-06-11 13:44</span> | <a id="a_comment_author_3995730" href="http://home.cnblogs.com/u/55916/" target="_blank">大漠孤阳</a> <a href="http://msg.cnblogs.com/send/%E5%A4%A7%E6%BC%A0%E5%AD%A4%E9%98%B3" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3995730" class="blog_comment_body">mark</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3995730,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3995730,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4011014" class="layer">#11楼</a><a name="4011014" id="comment_anchor_4011014"></a> <span class="comment_date">2018-07-02 20:02</span> | <a id="a_comment_author_4011014" href="https://www.cnblogs.com/cnasang/" target="_blank">暴力阿桑</a> <a href="http://msg.cnblogs.com/send/%E6%9A%B4%E5%8A%9B%E9%98%BF%E6%A1%91" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4011014" class="blog_comment_body">mark，大神</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4011014,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4011014,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4049287" class="layer">#12楼</a><a name="4049287" id="comment_anchor_4049287"></a> <span class="comment_date">2018-08-23 18:02</span> | <a id="a_comment_author_4049287" href="http://home.cnblogs.com/u/1215784/" target="_blank">xiaoli2333</a> <a href="http://msg.cnblogs.com/send/xiaoli2333" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4049287" class="blog_comment_body">mark</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4049287,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4049287,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4067988" class="layer">#13楼</a><a name="4067988" id="comment_anchor_4067988"></a> <span class="comment_date">2018-09-15 19:11</span> | <a id="a_comment_author_4067988" href="https://www.cnblogs.com/bixiaoyu/" target="_blank">忘情帝君</a> <a href="http://msg.cnblogs.com/send/%E5%BF%98%E6%83%85%E5%B8%9D%E5%90%9B" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4067988" class="blog_comment_body">你好！<br>我看你对ELK这篇博客，写的还不错，我最近也在研究，有一个问题，关于ELK收集mysql慢查询日志，我是用filebeat作为采集端，采集慢查询日志，推送到kafka消息队列，由Logsatsh拉取，logsatsh事件配置中grok正则之后进行输出，中间出了点问题。如果感兴趣的话，请加我QQ，我们在线交流谢谢~<br>QQ：1261813048（请标明备注）感谢~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4067988,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4067988,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4067988_avatar" style="display:none;">http://pic.cnblogs.com/face/1166362/20170515195021.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4089961" class="layer">#14楼</a><a name="4089961" id="comment_anchor_4089961"></a> <span class="comment_date">2018-10-15 15:34</span> | <a id="a_comment_author_4089961" href="https://www.cnblogs.com/geaozhang/" target="_blank">GeaoZhang</a> <a href="http://msg.cnblogs.com/send/GeaoZhang" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4089961" class="blog_comment_body">Mark and Niubility</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4089961,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4089961,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4089961_avatar" style="display:none;">http://pic.cnblogs.com/face/1113510/20180320175452.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4134741" class="layer">#15楼</a><a name="4134741" id="comment_anchor_4134741"></a> <span class="comment_date">2018-12-08 15:36</span> | <a id="a_comment_author_4134741" href="https://www.cnblogs.com/M18-BlankBox/" target="_blank">sed_'s/M18/黑匣子/'</a> <a href="http://msg.cnblogs.com/send/sed_%26%2339%3Bs%2FM18%2F%E9%BB%91%E5%8C%A3%E5%AD%90%2F%26%2339%3B" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4134741" class="blog_comment_body">elk里最难的是filter环节，最重要的插件就是grok，我们线上环境，tomcat多实例启动日志没有用log4j统一日志格式，导致你在用grok匹配的时候非常痛苦，你得兼顾每个日志的格式，否则你的filter结果有n多版本，所以一定要让开发一类应用程序统一日志格式，说说我遇到的问题，问题1 timestamp这绝对是个坑，我发现很多博客就没有说，timestamp这个是logstash 拉取到最新事件的时间，并不是业务日志的访问时间，也就是说你的业务日志每多一条日志，但里面的访问时间如果是昨天的，那么logstash采集到看到的@timestamp不是昨天的而是采集时候的系统时间。问题2 线上很多应用日志一般都是要进行切割的，有些切割工具在切割后，最新日志的文件会变成 catalina-2018-09-08.out，而不是catalina.out 固定的名字，这个需要自己在后台运行一个脚本，检查日志是否切割，如果切割配合软链接指向最新日志，input的时候，这要这个软链接可以了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4134741,&#39;Digg&#39;,this)">支持(3)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4134741,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4134741_avatar" style="display:none;">http://pic.cnblogs.com/face/917695/20160319181411.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4138593" class="layer">#16楼</a><a name="4138593" id="comment_anchor_4138593"></a> <span class="comment_date">2018-12-13 17:36</span> | <a id="a_comment_author_4138593" href="http://home.cnblogs.com/u/1465688/" target="_blank">黎明晓月</a> <a href="http://msg.cnblogs.com/send/%E9%BB%8E%E6%98%8E%E6%99%93%E6%9C%88" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4138593" class="blog_comment_body">大神，Mark</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4138593,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4138593,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4157438" class="layer">#17楼</a><a name="4157438" id="comment_anchor_4157438"></a> <span class="comment_date">2019-01-07 16:58</span> | <a id="a_comment_author_4157438" href="https://www.cnblogs.com/zougang/" target="_blank">Anan_Zou</a> <a href="http://msg.cnblogs.com/send/Anan_Zou" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4157438" class="blog_comment_body">mark,大神</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4157438,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4157438,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4157438_avatar" style="display:none;">http://pic.cnblogs.com/face/1105638/20180612113044.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4165256" class="layer">#18楼</a><a name="4165256" id="comment_anchor_4165256"></a> <span class="comment_date">2019-01-17 17:30</span> | <a id="a_comment_author_4165256" href="https://www.cnblogs.com/wwb-1024/" target="_blank">shaw_wwb</a> <a href="http://msg.cnblogs.com/send/shaw_wwb" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4165256" class="blog_comment_body">学习了，</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4165256,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4165256,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4168421" class="layer">#19楼</a><a name="4168421" id="comment_anchor_4168421"></a> <span class="comment_date">2019-01-22 18:50</span> | <a id="a_comment_author_4168421" href="https://www.cnblogs.com/Bob-wei/" target="_blank">Bob-wei</a> <a href="http://msg.cnblogs.com/send/Bob-wei" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4168421" class="blog_comment_body">辛苦啦，内容很完整！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4168421,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4168421,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4168421_avatar" style="display:none;">http://pic.cnblogs.com/face/u25099.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4249449" class="layer">#20楼</a><a name="4249449" id="comment_anchor_4249449"></a> <span class="comment_date">2019-05-07 10:50</span> | <a id="a_comment_author_4249449" href="https://www.cnblogs.com/nighteagle/" target="_blank">nightEagle</a> <a href="http://msg.cnblogs.com/send/nightEagle" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4249449" class="blog_comment_body">辛苦辛苦</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4249449,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4249449,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4254773" class="layer">#21楼</a><a name="4254773" id="comment_anchor_4254773"></a> <span class="comment_date">2019-05-13 17:18</span> | <a id="a_comment_author_4254773" href="https://www.cnblogs.com/moxiaopeng/" target="_blank">莫小鹏</a> <a href="http://msg.cnblogs.com/send/%E8%8E%AB%E5%B0%8F%E9%B9%8F" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4254773" class="blog_comment_body">好长的文章，资料好完整。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4254773,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4254773,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4266079" class="layer">#22楼</a><a name="4266079" id="comment_anchor_4266079"></a> <span class="comment_date">2019-05-27 16:01</span> | <a id="a_comment_author_4266079" href="https://www.cnblogs.com/dawnyxl/" target="_blank">面壁者罗辑，我是你的</a> <a href="http://msg.cnblogs.com/send/%E9%9D%A2%E5%A3%81%E8%80%85%E7%BD%97%E8%BE%91%EF%BC%8C%E6%88%91%E6%98%AF%E4%BD%A0%E7%9A%84" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4266079" class="blog_comment_body">很完整，学习了</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4266079,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4266079,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4268740" class="layer">#23楼</a><a name="4268740" id="comment_anchor_4268740"></a> <span class="comment_date">2019-05-30 11:50</span> | <a id="a_comment_author_4268740" href="http://home.cnblogs.com/u/1215764/" target="_blank">木鱼博客</a> <a href="http://msg.cnblogs.com/send/%E6%9C%A8%E9%B1%BC%E5%8D%9A%E5%AE%A2" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4268740" class="blog_comment_body">太赞了，很有干货的文章</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4268740,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4268740,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="https://www.cnblogs.com/kevingrace/p/5919021.html#4273625" class="layer">#24楼</a><a name="4273625" id="comment_anchor_4273625"></a><span id="comment-maxId" style="display:none;">4273625</span><span id="comment-maxDate" style="display:none;">2019/6/5 14:05:50</span> <span class="comment_date">2019-06-05 14:05</span> | <a id="a_comment_author_4273625" href="https://www.cnblogs.com/flyinghappysheep/" target="_blank">飞天遁地喜羊羊</a> <a href="http://msg.cnblogs.com/send/%E9%A3%9E%E5%A4%A9%E9%81%81%E5%9C%B0%E5%96%9C%E7%BE%8A%E7%BE%8A" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_4273625" class="blog_comment_body">膜拜大神！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(4273625,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(4273625,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_4273625_avatar" style="display:none;">http://pic.cnblogs.com/face/1501658/20180929172903.png</span>
			</div>
		</div>
	<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/kevingrace/p/5919021.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-工控&#39;)">【推荐】超50万C++/C#源码: 大型实时仿真组态图形源码</a><br><a href="https://www.grapecity.com.cn/developer/spreadjs?utm_source=cnblogs&amp;utm_medium=blogpage&amp;utm_term=bottom&amp;utm_content=SpreadJS&amp;utm_campaign=community" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-SpreadJS&#39;)">【前端】SpreadJS表格控件，可嵌入系统开发的在线Excel</a><br><a href="https://q.cnblogs.com/" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-博问&#39;)">【推荐】程序员问答平台，解决您开发中遇到的技术难题</a><br></div>
<div id="opt_under_post"></div>
<script async="async" src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/gpt.js.下载"></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>
<script>
  googletag.cmd.push(function() {
        googletag.defineSlot('/1090369/C1', [300, 250], 'div-gpt-ad-1546353474406-0').addService(googletag.pubads());
        googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
  });
</script>
<div id="cnblogs_c1" class="c_ad_block">
    <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;" data-google-query-id="CLfcqZXp1-MCFUc5lgodEakM8Q"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C1_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C1_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="1" data-load-complete="true" src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/saved_resource.html"></iframe></div></div>
</div>
<div id="under_post_news"><div class="recomm-block"><b>相关博文：</b><br>·  <a href="https://www.cnblogs.com/liu-yao/p/5678584.html" target="_blank" onclick="clickRecomItmem(5678584)">elk平台分析nginx日志的基本搭建</a><br>·  <a href="https://www.cnblogs.com/jicki/p/5548567.html" target="_blank" onclick="clickRecomItmem(5548567)">ELK   日志分析体系</a><br>·  <a href="https://www.cnblogs.com/ynyhl/p/9916623.html" target="_blank" onclick="clickRecomItmem(9916623)">ELK实时日志分析平台环境部署--完整记录</a><br>·  <a href="https://www.cnblogs.com/qlwang/p/9051750.html" target="_blank" onclick="clickRecomItmem(9051750)">ELK日志分析系统简单部署</a><br>·  <a href="https://www.cnblogs.com/allen-zhang/p/9383309.html" target="_blank" onclick="clickRecomItmem(9383309)">ELK实时日志分析平台环境部署--完整记录</a><br></div></div>
<div id="cnblogs_c2" class="c_ad_block">
    <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;" data-google-query-id="CPCiqJXp1-MCFUc5lgodEakM8Q"><div id="google_ads_iframe_/1090369/C2_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C2_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C2_0" width="468" height="60" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" style="border: 0px; vertical-align: bottom;" data-google-container-id="2" data-load-complete="true" src="./ELK实时日志分析平台环境部署--完整记录 - 散尽浮华 - 博客园_files/saved_resource(1).html"></iframe></div></div>
</div>
<div id="under_post_kb"><div class="itnews c_ad_block"><b>最新新闻</b>：<br> ·  <a href="https://news.cnblogs.com/n/628866/" target="_blank">在一个看似不可能的地方，隐藏着一个欣欣向荣的生命世界</a><br> ·  <a href="https://news.cnblogs.com/n/628865/" target="_blank">红帽 CTO Chris Wright：谈红帽在IBM收购后的未来发展</a><br> ·  <a href="https://news.cnblogs.com/n/628864/" target="_blank">5G无人扫路机已完成远程驾驶及清洁作业测试</a><br> ·  <a href="https://news.cnblogs.com/n/628863/" target="_blank">锐龙3000处理器BIOS更新忙中出错 月底公布最新进展</a><br> ·  <a href="https://news.cnblogs.com/n/628862/" target="_blank">本周，一颗小行星近距离掠过地球，人类为什么没警觉？</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
 if(enablePostBottom()) {
    codeHighlight();
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverT2();
    deliverC1();
    deliverC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);  
}
</script>
</div>

    
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><div id="profile_block">昵称：<a href="https://home.cnblogs.com/u/kevingrace/">散尽浮华</a><br>园龄：<a href="https://home.cnblogs.com/u/kevingrace/" title="入园时间：2016-03-07">3年4个月</a><br>粉丝：<a href="https://home.cnblogs.com/u/kevingrace/followers/">1998</a><br>关注：<a href="https://home.cnblogs.com/u/kevingrace/followees/">23</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;2423edd6-4be4-e511-9fc1-ac853d9f53cc&#39;)">+加关注</a></div><script>getFollowStatus('2423edd6-4be4-e511-9fc1-ac853d9f53cc')</script></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/06/01&#39;);return false;">&lt;</a></td><td align="center">2019年7月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/08/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">30</td><td align="center">1</td><td align="center">2</td><td align="center"><a href="https://www.cnblogs.com/kevingrace/archive/2019/07/03.html"><u>3</u></a></td><td align="center">4</td><td align="center">5</td><td class="CalWeekendDay" align="center">6</td></tr><tr><td class="CalWeekendDay" align="center">7</td><td align="center"><a href="https://www.cnblogs.com/kevingrace/archive/2019/07/08.html"><u>8</u></a></td><td align="center">9</td><td align="center">10</td><td align="center">11</td><td align="center">12</td><td class="CalWeekendDay" align="center">13</td></tr><tr><td class="CalWeekendDay" align="center">14</td><td align="center">15</td><td align="center">16</td><td align="center">17</td><td align="center">18</td><td align="center">19</td><td class="CalWeekendDay" align="center">20</td></tr><tr><td class="CalWeekendDay" align="center">21</td><td align="center">22</td><td align="center">23</td><td align="center">24</td><td align="center">25</td><td align="center">26</td><td class="CalWeekendDay" align="center">27</td></tr><tr><td class="CalTodayDay" align="center">28</td><td align="center">29</td><td align="center">30</td><td align="center">31</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td></tr><tr><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td><td class="CalOtherMonthDay" align="center">9</td><td class="CalOtherMonthDay" align="center">10</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<div class="catListLink">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="https://www.cnblogs.com/kevingrace/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="https://www.cnblogs.com/kevingrace/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="https://www.cnblogs.com/kevingrace/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="https://www.cnblogs.com/kevingrace/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="https://www.cnblogs.com/kevingrace/tag/" title="我的博客的标签列表">我的标签</a></li>
<li><a id="itemListLink" onclick="this.blur();WarpClass(&#39;itemListLink&#39;, &#39;itemListLin_con&#39;);return false;" href="https://www.cnblogs.com/kevingrace/p/5919021.html#">更多链接</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">
<ul>

</ul>
</div>
</div></div><div id="sidebar_toptags" class="sidebar-block"></div><div id="sidebar_categories">
<div class="catListPostCategory">
<h3 class="catListTitle">随笔分类</h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="https://www.cnblogs.com/kevingrace/category/924510.html">Ansible(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="https://www.cnblogs.com/kevingrace/category/924454.html">Apache(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="https://www.cnblogs.com/kevingrace/category/1129278.html">Ceph(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="https://www.cnblogs.com/kevingrace/category/924513.html">ClusterShell(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_4" href="https://www.cnblogs.com/kevingrace/category/911553.html">DNS(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_5" href="https://www.cnblogs.com/kevingrace/category/839227.html">Docker(27)</a> </li>

<li><a id="CatList_LinkList_0_Link_6" href="https://www.cnblogs.com/kevingrace/category/925329.html">DRBD(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_7" href="https://www.cnblogs.com/kevingrace/category/1099403.html">Elasticsearch(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_8" href="https://www.cnblogs.com/kevingrace/category/1362865.html">Etcd</a> </li>

<li><a id="CatList_LinkList_0_Link_9" href="https://www.cnblogs.com/kevingrace/category/924516.html">Expect(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_10" href="https://www.cnblogs.com/kevingrace/category/1363595.html">Fabric(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_11" href="https://www.cnblogs.com/kevingrace/category/1067863.html">FastDFS(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_12" href="https://www.cnblogs.com/kevingrace/category/924891.html">FTP(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_13" href="https://www.cnblogs.com/kevingrace/category/929881.html">GlusterFS (5)</a> </li>

<li><a id="CatList_LinkList_0_Link_14" href="https://www.cnblogs.com/kevingrace/category/924880.html">Haproxy(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_15" href="https://www.cnblogs.com/kevingrace/category/1165527.html">IP SAN(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_16" href="https://www.cnblogs.com/kevingrace/category/924884.html">Iptables(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_17" href="https://www.cnblogs.com/kevingrace/category/924512.html">Jenkins(8)</a> </li>

<li><a id="CatList_LinkList_0_Link_18" href="https://www.cnblogs.com/kevingrace/category/928638.html">Jira and Confluence(7)</a> </li>

<li><a id="CatList_LinkList_0_Link_19" href="https://www.cnblogs.com/kevingrace/category/924517.html">Jumpserver(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_20" href="https://www.cnblogs.com/kevingrace/category/1079836.html">Kafka(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_21" href="https://www.cnblogs.com/kevingrace/category/899066.html">LB+HA(23)</a> </li>

<li><a id="CatList_LinkList_0_Link_22" href="https://www.cnblogs.com/kevingrace/category/899069.html">LDAP(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_23" href="https://www.cnblogs.com/kevingrace/category/924896.html">LVM(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_24" href="https://www.cnblogs.com/kevingrace/category/924881.html">LVS(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_25" href="https://www.cnblogs.com/kevingrace/category/924895.html">Maven/Nexus(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_26" href="https://www.cnblogs.com/kevingrace/category/898773.html">Memcached(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_27" href="https://www.cnblogs.com/kevingrace/category/888957.html">MongoDB(11)</a> </li>

<li><a id="CatList_LinkList_0_Link_28" href="https://www.cnblogs.com/kevingrace/category/924882.html">MooseFS(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_29" href="https://www.cnblogs.com/kevingrace/category/1115510.html">MQ-消息队列(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_30" href="https://www.cnblogs.com/kevingrace/category/796278.html">Mysql(65)</a> </li>

<li><a id="CatList_LinkList_0_Link_31" href="https://www.cnblogs.com/kevingrace/category/924883.html">NFS(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_32" href="https://www.cnblogs.com/kevingrace/category/839102.html">Nginx(51)</a> </li>

<li><a id="CatList_LinkList_0_Link_33" href="https://www.cnblogs.com/kevingrace/category/924453.html">PHP(10)</a> </li>

<li><a id="CatList_LinkList_0_Link_34" href="https://www.cnblogs.com/kevingrace/category/924515.html">Puppet(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_35" href="https://www.cnblogs.com/kevingrace/category/796274.html">Python(12)</a> </li>

<li><a id="CatList_LinkList_0_Link_36" href="https://www.cnblogs.com/kevingrace/category/888956.html">Redis(17)</a> </li>

<li><a id="CatList_LinkList_0_Link_37" href="https://www.cnblogs.com/kevingrace/category/924886.html">Rsync(8)</a> </li>

<li><a id="CatList_LinkList_0_Link_38" href="https://www.cnblogs.com/kevingrace/category/796271.html">Saltstack(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_39" href="https://www.cnblogs.com/kevingrace/category/1187446.html">Samba(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_40" href="https://www.cnblogs.com/kevingrace/category/796275.html">Shell(34)</a> </li>

<li><a id="CatList_LinkList_0_Link_41" href="https://www.cnblogs.com/kevingrace/category/924451.html">Squid(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_42" href="https://www.cnblogs.com/kevingrace/category/924885.html">SSH(7)</a> </li>

<li><a id="CatList_LinkList_0_Link_43" href="https://www.cnblogs.com/kevingrace/category/1079565.html">Supervisor/Monit(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_44" href="https://www.cnblogs.com/kevingrace/category/924446.html">Tomcat(11)</a> </li>

<li><a id="CatList_LinkList_0_Link_45" href="https://www.cnblogs.com/kevingrace/category/927096.html">Ubuntu(9)</a> </li>

<li><a id="CatList_LinkList_0_Link_46" href="https://www.cnblogs.com/kevingrace/category/924450.html">Varnish(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_47" href="https://www.cnblogs.com/kevingrace/category/927534.html">VPN(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_48" href="https://www.cnblogs.com/kevingrace/category/1067862.html">Zookeeper(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_49" href="https://www.cnblogs.com/kevingrace/category/1142292.html">安全性能(30)</a> </li>

<li><a id="CatList_LinkList_0_Link_50" href="https://www.cnblogs.com/kevingrace/category/860276.html">版本控制(31)</a> </li>

<li><a id="CatList_LinkList_0_Link_51" href="https://www.cnblogs.com/kevingrace/category/796260.html">常规运维(86)</a> </li>

<li><a id="CatList_LinkList_0_Link_52" href="https://www.cnblogs.com/kevingrace/category/796277.html">监控系统(43)</a> </li>

<li><a id="CatList_LinkList_0_Link_53" href="https://www.cnblogs.com/kevingrace/category/888028.html">日志分析(8)</a> </li>

<li><a id="CatList_LinkList_0_Link_54" href="https://www.cnblogs.com/kevingrace/category/796272.html">虚拟化(30)</a> </li>

<li><a id="CatList_LinkList_0_Link_55" href="https://www.cnblogs.com/kevingrace/category/920574.html">邮件服务(3)</a> </li>

</ul>

</div>

<div class="catListPostArchive">
<h3 class="catListTitle">随笔档案</h3>

<ul>

<li><a id="CatList_LinkList_1_Link_0" href="https://www.cnblogs.com/kevingrace/archive/2019/07.html">2019年7月 (4)</a> </li>

<li><a id="CatList_LinkList_1_Link_1" href="https://www.cnblogs.com/kevingrace/archive/2019/06.html">2019年6月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_2" href="https://www.cnblogs.com/kevingrace/archive/2019/04.html">2019年4月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_3" href="https://www.cnblogs.com/kevingrace/archive/2019/03.html">2019年3月 (6)</a> </li>

<li><a id="CatList_LinkList_1_Link_4" href="https://www.cnblogs.com/kevingrace/archive/2019/02.html">2019年2月 (6)</a> </li>

<li><a id="CatList_LinkList_1_Link_5" href="https://www.cnblogs.com/kevingrace/archive/2019/01.html">2019年1月 (6)</a> </li>

<li><a id="CatList_LinkList_1_Link_6" href="https://www.cnblogs.com/kevingrace/archive/2018/12.html">2018年12月 (9)</a> </li>

<li><a id="CatList_LinkList_1_Link_7" href="https://www.cnblogs.com/kevingrace/archive/2018/11.html">2018年11月 (7)</a> </li>

<li><a id="CatList_LinkList_1_Link_8" href="https://www.cnblogs.com/kevingrace/archive/2018/10.html">2018年10月 (10)</a> </li>

<li><a id="CatList_LinkList_1_Link_9" href="https://www.cnblogs.com/kevingrace/archive/2018/09.html">2018年9月 (9)</a> </li>

<li><a id="CatList_LinkList_1_Link_10" href="https://www.cnblogs.com/kevingrace/archive/2018/08.html">2018年8月 (12)</a> </li>

<li><a id="CatList_LinkList_1_Link_11" href="https://www.cnblogs.com/kevingrace/archive/2018/07.html">2018年7月 (11)</a> </li>

<li><a id="CatList_LinkList_1_Link_12" href="https://www.cnblogs.com/kevingrace/archive/2018/06.html">2018年6月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_13" href="https://www.cnblogs.com/kevingrace/archive/2018/05.html">2018年5月 (12)</a> </li>

<li><a id="CatList_LinkList_1_Link_14" href="https://www.cnblogs.com/kevingrace/archive/2018/04.html">2018年4月 (11)</a> </li>

<li><a id="CatList_LinkList_1_Link_15" href="https://www.cnblogs.com/kevingrace/archive/2018/03.html">2018年3月 (8)</a> </li>

<li><a id="CatList_LinkList_1_Link_16" href="https://www.cnblogs.com/kevingrace/archive/2018/02.html">2018年2月 (12)</a> </li>

<li><a id="CatList_LinkList_1_Link_17" href="https://www.cnblogs.com/kevingrace/archive/2018/01.html">2018年1月 (21)</a> </li>

<li><a id="CatList_LinkList_1_Link_18" href="https://www.cnblogs.com/kevingrace/archive/2017/12.html">2017年12月 (17)</a> </li>

<li><a id="CatList_LinkList_1_Link_19" href="https://www.cnblogs.com/kevingrace/archive/2017/11.html">2017年11月 (12)</a> </li>

<li><a id="CatList_LinkList_1_Link_20" href="https://www.cnblogs.com/kevingrace/archive/2017/10.html">2017年10月 (6)</a> </li>

<li><a id="CatList_LinkList_1_Link_21" href="https://www.cnblogs.com/kevingrace/archive/2017/09.html">2017年9月 (10)</a> </li>

<li><a id="CatList_LinkList_1_Link_22" href="https://www.cnblogs.com/kevingrace/archive/2017/08.html">2017年8月 (7)</a> </li>

<li><a id="CatList_LinkList_1_Link_23" href="https://www.cnblogs.com/kevingrace/archive/2017/07.html">2017年7月 (5)</a> </li>

<li><a id="CatList_LinkList_1_Link_24" href="https://www.cnblogs.com/kevingrace/archive/2017/06.html">2017年6月 (6)</a> </li>

<li><a id="CatList_LinkList_1_Link_25" href="https://www.cnblogs.com/kevingrace/archive/2017/05.html">2017年5月 (8)</a> </li>

<li><a id="CatList_LinkList_1_Link_26" href="https://www.cnblogs.com/kevingrace/archive/2017/04.html">2017年4月 (10)</a> </li>

<li><a id="CatList_LinkList_1_Link_27" href="https://www.cnblogs.com/kevingrace/archive/2017/03.html">2017年3月 (11)</a> </li>

<li><a id="CatList_LinkList_1_Link_28" href="https://www.cnblogs.com/kevingrace/archive/2017/02.html">2017年2月 (15)</a> </li>

<li><a id="CatList_LinkList_1_Link_29" href="https://www.cnblogs.com/kevingrace/archive/2017/01.html">2017年1月 (36)</a> </li>

<li><a id="CatList_LinkList_1_Link_30" href="https://www.cnblogs.com/kevingrace/archive/2016/12.html">2016年12月 (41)</a> </li>

<li><a id="CatList_LinkList_1_Link_31" href="https://www.cnblogs.com/kevingrace/archive/2016/11.html">2016年11月 (34)</a> </li>

<li><a id="CatList_LinkList_1_Link_32" href="https://www.cnblogs.com/kevingrace/archive/2016/10.html">2016年10月 (30)</a> </li>

<li><a id="CatList_LinkList_1_Link_33" href="https://www.cnblogs.com/kevingrace/archive/2016/09.html">2016年9月 (35)</a> </li>

<li><a id="CatList_LinkList_1_Link_34" href="https://www.cnblogs.com/kevingrace/archive/2016/08.html">2016年8月 (35)</a> </li>

<li><a id="CatList_LinkList_1_Link_35" href="https://www.cnblogs.com/kevingrace/archive/2016/07.html">2016年7月 (37)</a> </li>

<li><a id="CatList_LinkList_1_Link_36" href="https://www.cnblogs.com/kevingrace/archive/2016/06.html">2016年6月 (37)</a> </li>

<li><a id="CatList_LinkList_1_Link_37" href="https://www.cnblogs.com/kevingrace/archive/2016/03.html">2016年3月 (3)</a> </li>

</ul>

</div>

<div class="catList">
<h3 class="catListTitle">Linux加油站</h3>

<ul>

<li><a id="CatList_LinkList_2_Link_0" href="http://www.ansible.com.cn/" rel="nofollow">Ansible中文权威指南</a> </li>

<li><a id="CatList_LinkList_2_Link_1" href="https://www.cnblogs.com/emanlee/p/3327576.html" rel="nofollow">AWK使用手册</a> </li>

<li><a id="CatList_LinkList_2_Link_2" href="http://dl.fedoraproject.org/pub/epel/" rel="nofollow">Centos的epel源下载</a> </li>

<li><a id="CatList_LinkList_2_Link_3" href="http://ceph.org.cn/category/docs/">Ceph开源社区</a> </li>

<li><a id="CatList_LinkList_2_Link_4" href="https://github.com/CodisLabs/codis/blob/release3.2/doc/tutorial_zh.md" rel="nofollow">Codis教程</a> </li>

<li><a id="CatList_LinkList_2_Link_5" href="http://www.ziqiangxuetang.com/django/django-tutorial.html" rel="nofollow">Django基础教程</a> </li>

<li><a id="CatList_LinkList_2_Link_6" href="http://wiki.jikexueyuan.com/project/docker-technology-and-combat/what.html" rel="nofollow">Docker基础学习</a> </li>

<li><a id="CatList_LinkList_2_Link_7" href="https://hub.docker.com/explore/" rel="nofollow">Docker镜像-hub.docker</a> </li>

<li><a id="CatList_LinkList_2_Link_8" href="https://elasticsearch.cn/article/" rel="nofollow">Elasticsearch 中文社区</a> </li>

<li><a id="CatList_LinkList_2_Link_9" href="http://www.runoob.com/git/git-basic-operations.html" rel="nofollow">Git基础教程</a> </li>

<li><a id="CatList_LinkList_2_Link_10" href="https://github.com/jackhu1990/golangman" rel="nofollow">Go语言学习速查手册</a> </li>

<li><a id="CatList_LinkList_2_Link_11" href="https://studygolang.com/articles" rel="nofollow">Go语言中文网</a> </li>

<li><a id="CatList_LinkList_2_Link_12" href="http://www.restapitutorial.com/httpstatuscodes.html#" rel="nofollow">HTTP Status Codes</a> </li>

<li><a id="CatList_LinkList_2_Link_13" href="http://www.udpwork.com/?s=docker" rel="nofollow">IT牛人博客-运维学习</a> </li>

<li><a id="CatList_LinkList_2_Link_14" href="https://mritd.me/2018/01/07/kubernetes-tls-bootstrapping-note/" rel="nofollow">Kubernetes TLS bootstrapping 那点事</a> </li>

<li><a id="CatList_LinkList_2_Link_15" href="https://github.com/opsnull/follow-me-install-kubernetes-cluster" rel="nofollow">Kubernetes 集群部署参考</a> </li>

<li><a id="CatList_LinkList_2_Link_16" href="https://www.kubernetes.org.cn/docs" rel="nofollow">Kubernetes 中文社区</a> </li>

<li><a id="CatList_LinkList_2_Link_17" href="http://man.linuxde.net/" rel="nofollow">Linux命令大全</a> </li>

<li><a id="CatList_LinkList_2_Link_18" href="https://www.centos.bz/tag/docker/" rel="nofollow">Linux运维日志</a> </li>

<li><a id="CatList_LinkList_2_Link_19" href="https://blog.cactifans.com/" rel="nofollow">Linux专注监控的博客</a> </li>

<li><a id="CatList_LinkList_2_Link_20" href="http://ftp.ntu.edu.tw/MySQL/Downloads/" rel="nofollow">Mysql源码下载</a> </li>

<li><a id="CatList_LinkList_2_Link_21" href="http://nginx.org/en/docs/" rel="nofollow">Nginx官方配置(Modules reference)</a> </li>

<li><a id="CatList_LinkList_2_Link_22" href="https://book.open-falcon.org/zh" rel="nofollow">Open-falcon社区文档</a> </li>

<li><a id="CatList_LinkList_2_Link_23" href="https://openresty.org/cn/" rel="nofollow">OpenResty--Nginx和LuaJIT的Web平台</a> </li>

<li><a id="CatList_LinkList_2_Link_24" href="https://github.com/yunlzheng/prometheus-book" rel="nofollow">Prometheus 操作指南</a> </li>

<li><a id="CatList_LinkList_2_Link_25" href="https://www.bookstack.cn/read/prometheus-manual/introduction-overview.md" rel="nofollow">Prometheus 中文手册 </a> </li>

<li><a id="CatList_LinkList_2_Link_26" href="http://yum.puppetlabs.com/" rel="nofollow">Puppet安装版本下载</a> </li>

<li><a id="CatList_LinkList_2_Link_27" href="http://python3-cookbook.readthedocs.io/zh_CN/latest/preface.html" rel="nofollow">Python3-cookbook</a> </li>

<li><a id="CatList_LinkList_2_Link_28" href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001432712108300322c61f256c74803b43bfd65c6f8d0d0000" rel="nofollow">Python学习- 推荐网站</a> </li>

<li><a id="CatList_LinkList_2_Link_29" href="https://pan.baidu.com/s/1eS0y3xo" rel="nofollow">Python学习资料-中文电子书分享</a> </li>

<li><a id="CatList_LinkList_2_Link_30" href="https://github.com/yorkoliu/pyauto" rel="nofollow">Python自动化运维-案例源码</a> </li>

<li><a id="CatList_LinkList_2_Link_31" href="https://www.cnblogs.com/xiaozhiqi/default.html?page=1" rel="nofollow">Python自动化运维之路</a> </li>

<li><a id="CatList_LinkList_2_Link_32" href="https://rancher.com/docs/rancher/v1.6/zh/" rel="nofollow">Rancher 部署文档</a> </li>

<li><a id="CatList_LinkList_2_Link_33" href="http://doc.redisfans.com/" rel="nofollow">Redis命令参考</a> </li>

<li><a id="CatList_LinkList_2_Link_34" href="http://www.runoob.com/" rel="nofollow">RUNOOB.COM - 编程学习</a> </li>

<li><a id="CatList_LinkList_2_Link_35" href="https://www.runoob.com/linux/linux-shell-passing-arguments.html" rel="nofollow">Shell传递的参数说明</a> </li>

<li><a id="CatList_LinkList_2_Link_36" href="http://www.phpfans.net/manu/Squid/" rel="nofollow">Squid中文权威指南</a> </li>

<li><a id="CatList_LinkList_2_Link_37" href="http://www.supervisord.org/configuration.html" rel="nofollow">Supervisor教程</a> </li>

<li><a id="CatList_LinkList_2_Link_38" href="https://www.centos.bz/tag/swarm/page/3/" rel="nofollow">Swarm管理-Linux运维日志</a> </li>

<li><a id="CatList_LinkList_2_Link_39" href="http://tengine.taobao.org/documentation_cn.html" rel="nofollow">Tengine参考文档</a> </li>

<li><a id="CatList_LinkList_2_Link_40" href="https://www.cnblogs.com/xuliangwei/p/6658838.html" rel="nofollow">Zabbix完整监控 - 配置教程</a> </li>

<li><a id="CatList_LinkList_2_Link_41" href="http://mirrors.aliyun.com/" rel="nofollow">阿里开源镜像</a> </li>

<li><a id="CatList_LinkList_2_Link_42" href="http://blog.jobbole.com/tag/lvs/" rel="nofollow">博客在线-LVS</a> </li>

<li><a id="CatList_LinkList_2_Link_43" href="https://blog.csdn.net/u013613428/article/details/78179430" rel="nofollow">监控ElasticSearch性能指标</a> </li>

<li><a id="CatList_LinkList_2_Link_44" href="https://alanhou.org/python-scripting-overview/" rel="nofollow">精通Python自动化脚本</a> </li>

<li><a id="CatList_LinkList_2_Link_45" href="https://www.cnblogs.com/peida/archive/2012/12/05/2803591.html">每天一个linux命令</a> </li>

<li><a id="CatList_LinkList_2_Link_46" href="http://cn.linux.vbird.org/" rel="nofollow">鸟哥的Linux私房菜</a> </li>

<li><a id="CatList_LinkList_2_Link_47" href="http://mirrors.163.com/" rel="nofollow">网易开源镜像</a> </li>

<li><a id="CatList_LinkList_2_Link_48" href="http://www.17ce.com/" rel="nofollow">网站速度测试-17ce</a> </li>

<li><a id="CatList_LinkList_2_Link_49" href="http://www.91ri.org/" rel="nofollow">我的攻防安全指南</a> </li>

<li><a id="CatList_LinkList_2_Link_50" href="https://www.kancloud.cn/huyipow/prometheus/527093" rel="nofollow">以优雅姿态监控 Kubernetes</a> </li>

<li><a id="CatList_LinkList_2_Link_51" href="http://www.okay686.cn/897.html" rel="nofollow">优质博客-运维</a> </li>

<li><a id="CatList_LinkList_2_Link_52" href="http://whois.chinaz.com/" rel="nofollow">域名信息查询平台</a> </li>

<li><a id="CatList_LinkList_2_Link_53" href="http://www.yunweipai.com/category/jingyan">运维派</a> </li>

<li><a id="CatList_LinkList_2_Link_54" href="https://www.cnblogs.com/f-ck-need-u/" rel="nofollow">值得学习的牛人博客</a> </li>

</ul>

</div>

</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>

	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/5252929.html#4309961">1. Re:Docker容器基础介绍</a></li>
        <li class="recent_comment_body">杨过大侠你好! 你原文的句子"不要在容器中存储数据 – 容器可能被停止，销毁，或替换。一个运行在容器中的程序版本1.0，应该很容易被1.1的版本替换且不影响或损失数据。有鉴于此，如.........</li>
        <li class="recent_comment_author">--darenzhoudba</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/7607442.html#4307593">2. Re:Centos下安装破解confluence6.3的操作记录</a></li>
        <li class="recent_comment_body">@nq_linux在配置界面里更改默认语言为中文...</li>
        <li class="recent_comment_author">--散尽浮华</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/7607442.html#4307524">3. Re:Centos下安装破解confluence6.3的操作记录</a></li>
        <li class="recent_comment_body">楼主，你好。按照你的教程安装成功了，非常感谢。但是有点奇怪的是，我在最后一步执行完之后，页面就变成英文了（最开始的一步里面，我已经选择了中文，并且一路都是中文）。请问能给点指点吗？...</li>
        <li class="recent_comment_author">--nq_linux</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/5947695.html#4307269">4. Re:linux下安装php的imagick扩展模块（附php升级脚本）</a></li>
        <li class="recent_comment_body">@与威尔已更新~...</li>
        <li class="recent_comment_author">--散尽浮华</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/5947695.html#4306809">5. Re:linux下安装php的imagick扩展模块（附php升级脚本）</a></li>
        <li class="recent_comment_body"><br><br><br>第一个百度网盘下载链接。。。。。。。。</li>
        <li class="recent_comment_author">--与威尔</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/8260032.html#4306425">6. Re:linux下监控某个目录是否被更改</a></li>
        <li class="recent_comment_body">非常好</li>
        <li class="recent_comment_author">--renzhehongyi</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/7607442.html#4306134">7. Re:Centos下安装破解confluence6.3的操作记录</a></li>
        <li class="recent_comment_body">楼主百度云都失效了能在提供下嘛</li>
        <li class="recent_comment_author">--小小飞侠</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/10995648.html#4304575">8. Re:Kubernetes容器集群管理环境 - 完整部署（下篇）</a></li>
        <li class="recent_comment_body">前辈 我的metrics-server出现了这样的报错，请问我该如何解决一下呢？metrics-server-584bcd8b5f-lzsjx 1/1 Running 0 ......</li>
        <li class="recent_comment_author">--紫色飞猪</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/5825963.html#4304097">9. Re:Linux下对lvm逻辑卷分区大小的调整（针对xfs和ext4不同文件系统）</a></li>
        <li class="recent_comment_body">完美解决了我的问题！！！</li>
        <li class="recent_comment_author">--南风深蓝</li>
        <li class="recent_comment_title"><a href="https://www.cnblogs.com/kevingrace/p/10995648.html#4301758">10. Re:Kubernetes容器集群管理环境 - 完整部署（下篇）</a></li>
        <li class="recent_comment_body">@散尽浮华好的，谢谢！！！E0715 07:28:07.211366 33412 available_controller.go:316] v1beta1.metrics.k8s.io failed ......</li>
        <li class="recent_comment_author">--herocjx</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock"><ul><li><a href="https://www.cnblogs.com/kevingrace/p/5690241.html">1. Git忽略提交规则 - .gitignore配置运维总结(380065)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5919021.html">2. ELK实时日志分析平台环境部署--完整记录(159518)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5707003.html">3. 完整部署CentOS7.2+OpenStack+kvm 云平台环境（1）--基础环境搭建(125757)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5904800.html">4. mysql数据库误删除后的数据恢复操作说明(114544)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6496899.html">5. Linux终端复用神器-Tmux使用梳理(111291)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5907254.html">6. Mysql之binlog日志说明及利用binlog日志恢复数据操作记录(67136)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6150748.html">7. mysql表名忽略大小写问题记录(65932)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5685355.html">8. MySQL两种存储引擎: MyISAM和InnoDB 简单总结(63729)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6479813.html">9. Gitlab利用Webhook实现Push代码后的jenkins自动构建(62507)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6259905.html">10. 执行git push出现"Everything up-to-date"(62161)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock"><ul><li><a href="https://www.cnblogs.com/kevingrace/p/5707003.html">1. 完整部署CentOS7.2+OpenStack+kvm 云平台环境（1）--基础环境搭建(119)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5919021.html">2. ELK实时日志分析平台环境部署--完整记录(24)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5651447.html">3. [原创]CI持续集成系统环境--Gitlab+Gerrit+Jenkins完整对接(20)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5737724.html">4. kvm虚拟化管理平台WebVirtMgr部署-完整记录(1)(18)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/7608813.html">5. Centos下安装破解Jira7的操作记录(18)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">推荐排行榜</h3>
<div id="TopDiggPostsBlock"><ul><li><a href="https://www.cnblogs.com/kevingrace/p/5690241.html">1. Git忽略提交规则 - .gitignore配置运维总结(34)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5919021.html">2. ELK实时日志分析平台环境部署--完整记录(29)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5707003.html">3. 完整部署CentOS7.2+OpenStack+kvm 云平台环境（1）--基础环境搭建(20)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6201984.html">4. Maven私服Nexus3.x环境构建操作记录(12)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5904595.html">5. SVN和Git对比梳理(12)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5907254.html">6. Mysql之binlog日志说明及利用binlog日志恢复数据操作记录(11)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6307298.html">7. 运维中的日志切割操作梳理（Logrotate/python/shell脚本实现）(10)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/6261091.html">8. mysql主从同步(3)-percona-toolkit工具（数据一致性监测、延迟监控）使用梳理(9)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/5896706.html">9. 简单对比git pull和git pull --rebase的使用(9)</a></li><li><a href="https://www.cnblogs.com/kevingrace/p/9004460.html">10. Redis哨兵模式（sentinel）学习总结及部署记录（主从复制、读写分离、主从切换）(8)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2019 散尽浮华
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->



</body></html>